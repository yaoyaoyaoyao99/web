(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-dbcb8b50"],{"10f3":function(t,e,i){"use strict";i.d(e,"e",(function(){return a})),i.d(e,"d",(function(){return s})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return u})),i.d(e,"g",(function(){return o})),i.d(e,"f",(function(){return l})),i.d(e,"b",(function(){return c}));var r=i("b775");function a(t){return Object(r["a"])({url:"/iot/group/list",method:"get",params:t})}function s(t){return Object(r["a"])({url:"/iot/group/"+t,method:"get"})}function n(t){return Object(r["a"])({url:"/iot/group/getDeviceIds/"+t,method:"get"})}function u(t){return Object(r["a"])({url:"/iot/group",method:"post",data:t})}function o(t){return Object(r["a"])({url:"/iot/group",method:"put",data:t})}function l(t){return Object(r["a"])({url:"/iot/group/updateDeviceGroups",method:"put",data:t})}function c(t){return Object(r["a"])({url:"/iot/group/"+t,method:"delete"})}},"4efc":function(t,e,i){t.exports=i.p+"static/img/gateway.5a51e30f.png"},"52bb":function(t,e,i){t.exports=i.p+"static/img/product.66c3c4d5.png"},"584f":function(t,e,i){"use strict";i.d(e,"l",(function(){return a})),i.d(e,"j",(function(){return s})),i.d(e,"k",(function(){return n})),i.d(e,"i",(function(){return u})),i.d(e,"e",(function(){return o})),i.d(e,"c",(function(){return l})),i.d(e,"f",(function(){return c})),i.d(e,"h",(function(){return d})),i.d(e,"g",(function(){return m})),i.d(e,"a",(function(){return p})),i.d(e,"m",(function(){return h})),i.d(e,"b",(function(){return v})),i.d(e,"d",(function(){return f}));var r=i("b775");function a(t){return Object(r["a"])({url:"/iot/device/unAuthlist",method:"get",params:t})}function s(t){return Object(r["a"])({url:"/iot/device/listByGroup",method:"get",params:t})}function n(t){return Object(r["a"])({url:"/iot/device/shortList",method:"get",params:t})}function u(){return Object(r["a"])({url:"/iot/device/all",method:"get"})}function o(t){return Object(r["a"])({url:"/iot/device/"+t,method:"get"})}function l(t){return Object(r["a"])({url:"/iot/device/synchronization/"+t,method:"get"})}function c(t){return Object(r["a"])({url:"/iot/device/getDeviceBySerialNumber/"+t,method:"get"})}function d(){return Object(r["a"])({url:"/iot/device/statistic",method:"get"})}function m(t){return Object(r["a"])({url:"/iot/device/runningStatus/"+t,method:"get"})}function p(t){return Object(r["a"])({url:"/iot/device",method:"post",data:t})}function h(t){return Object(r["a"])({url:"/iot/device",method:"put",data:t})}function v(t){return Object(r["a"])({url:"/iot/device/"+t,method:"delete"})}function f(){return Object(r["a"])({url:"/iot/device/generator",method:"get"})}},"7d0d":function(t,e,i){},bc98:function(t,e,i){"use strict";i("7d0d")},c572:function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticStyle:{padding:"6px"}},[r("el-card",{staticStyle:{"margin-bottom":"6px"}},[r("el-form",{ref:"queryForm",staticStyle:{"margin-bottom":"-20px"},attrs:{model:t.queryParams,inline:!0,"label-width":"75px"}},[r("el-form-item",{attrs:{label:"设备名称",prop:"deviceName"}},[r("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"请输入设备名称",clearable:"",size:"small"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleQuery(e)}},model:{value:t.queryParams.deviceName,callback:function(e){t.$set(t.queryParams,"deviceName",e)},expression:"queryParams.deviceName"}})],1),r("el-form-item",{attrs:{label:"设备编号",prop:"serialNumber"}},[r("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"请输入设备编号",clearable:"",size:"small"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleQuery(e)}},model:{value:t.queryParams.serialNumber,callback:function(e){t.$set(t.queryParams,"serialNumber",e)},expression:"queryParams.serialNumber"}})],1),r("el-form-item",{attrs:{label:"设备状态",prop:"status"}},[r("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择设备状态",clearable:"",size:"small"},model:{value:t.queryParams.status,callback:function(e){t.$set(t.queryParams,"status",e)},expression:"queryParams.status"}},t._l(t.dict.type.iot_device_status,(function(t){return r("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),r("el-form-item",{attrs:{label:"我的分组"}},[r("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择我的分组",clearable:"",size:"small"},model:{value:t.queryParams.groupId,callback:function(e){t.$set(t.queryParams,"groupId",e)},expression:"queryParams.groupId"}},t._l(t.myGroupList,(function(t){return r("el-option",{key:t.groupId,attrs:{label:t.groupName,value:t.groupId}})})),1)],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:t.handleQuery}},[t._v("搜索")]),r("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:t.resetQuery}},[t._v("重置")])],1),r("el-form-item",{staticStyle:{float:"right"}},[r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:device:add"],expression:"['iot:device:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"mini"},on:{click:function(e){return t.handleEditDevice(0)}}},[t._v("新增")])],1)],1)],1),r("el-card",{staticStyle:{"padding-bottom":"100px"}},[r("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{gutter:30}},t._l(t.deviceList,(function(e,a){return r("el-col",{key:a,staticStyle:{"margin-bottom":"30px","text-align":"center"},attrs:{xs:24,sm:12,md:12,lg:8,xl:6}},[r("el-card",{staticClass:"card-item",attrs:{"body-style":{padding:"20px"},shadow:"always"}},[r("el-row",{attrs:{type:"flex",gutter:10,justify:"space-between"}},[r("el-col",{staticStyle:{"text-align":"left"},attrs:{span:20}},[r("el-link",{staticStyle:{"font-weight":"bold","font-size":"16px","line-height":"32px"},attrs:{type:"",underline:!1},on:{click:function(i){return t.handleEditDevice(e)}}},[r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"分享的设备",placement:"top-start"}},[1!=e.isOwner?r("svg-icon",{staticStyle:{"font-size":"20px"},attrs:{"icon-class":"share"}}):t._e()],1),1==e.isOwner?r("svg-icon",{attrs:{"icon-class":"device"}}):t._e(),r("span",{staticStyle:{margin:"0 5px"}},[t._v(t._s(e.deviceName))]),r("el-tag",{attrs:{size:"mini",type:"info"}},[t._v("Ver "+t._s(e.firmwareVersion))])],1)],1),r("el-col",{attrs:{span:4}},[r("div",{staticStyle:{"font-size":"28px",color:"#ccc"}},[3==e.status&&e.rssi>="-55"?r("svg-icon",{attrs:{"icon-class":"wifi_4"}}):3==e.status&&e.rssi>="-70"&&e.rssi<"-55"?r("svg-icon",{attrs:{"icon-class":"wifi_3"}}):3==e.status&&e.rssi>="-85"&&e.rssi<"-70"?r("svg-icon",{attrs:{"icon-class":"wifi_2"}}):3==e.status&&e.rssi>="-100"&&e.rssi<"-85"?r("svg-icon",{attrs:{"icon-class":"wifi_1"}}):r("svg-icon",{attrs:{"icon-class":"wifi_0"}})],1)])],1),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:15}},[r("div",{staticStyle:{"text-align":"left","line-height":"40px","white-space":"nowrap"}},[r("dict-tag",{staticStyle:{display:"inline-block"},attrs:{options:t.dict.type.iot_device_status,value:e.status,size:"small"}}),r("span",{staticStyle:{display:"inline-block",margin:"0 10px"}},[1==e.isShadow?r("el-tag",{attrs:{type:"success",size:"small"}},[t._v("影子")]):r("el-tag",{attrs:{type:"info",size:"small"}},[t._v("影子")])],1),r("dict-tag",{staticStyle:{display:"inline-block"},attrs:{options:t.dict.type.iot_location_way,value:e.locationWay,size:"small"}})],1),r("el-descriptions",{staticStyle:{"white-space":"nowrap"},attrs:{column:1,size:"mini"}},[r("el-descriptions-item",{attrs:{label:"编号"}},[t._v(" "+t._s(e.serialNumber)+" ")]),r("el-descriptions-item",{attrs:{label:"产品"}},[t._v(" "+t._s(e.productName)+" ")]),r("el-descriptions-item",{attrs:{label:"激活时间"}},[t._v(" "+t._s(t.parseTime(e.activeTime,"{y}-{m}-{d}"))+" ")])],1)],1),r("el-col",{attrs:{span:9}},[r("div",{staticStyle:{"margin-top":"10px"}},[null!=e.imgUrl&&""!=e.imgUrl?r("el-image",{staticStyle:{width:"100%",height:"100px","border-radius":"10px"},attrs:{lazy:"","preview-src-list":[t.baseUrl+e.imgUrl],src:t.baseUrl+e.imgUrl,fit:"cover"}}):2==e.deviceType?r("el-image",{staticStyle:{width:"100%",height:"100px","border-radius":"10px"},attrs:{"preview-src-list":[i("4efc")],src:i("4efc"),fit:"cover"}}):3==e.deviceType?r("el-image",{staticStyle:{width:"100%",height:"100px","border-radius":"10px"},attrs:{"preview-src-list":[i("c59e")],src:i("c59e"),fit:"cover"}}):r("el-image",{staticStyle:{width:"100%",height:"100px","border-radius":"10px"},attrs:{"preview-src-list":[i("52bb")],src:i("52bb"),fit:"cover"}})],1)])],1),r("el-button-group",{staticStyle:{"margin-top":"15px"}},[r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:device:remove"],expression:"['iot:device:remove']"}],staticStyle:{padding:"5px 10px"},attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(i){return t.handleDelete(e)}}},[t._v("删除 ")]),r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:device:add"],expression:"['iot:device:add']"}],staticStyle:{padding:"5px 15px"},attrs:{type:"primary",size:"mini",icon:"el-icon-view"},on:{click:function(i){return t.handleEditDevice(e)}}},[t._v("查看 ")]),r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:device:add"],expression:"['iot:device:add']"}],staticStyle:{padding:"5px 15px"},attrs:{type:"success",size:"mini",icon:"el-icon-odometer"},on:{click:function(i){return t.handleEditDevice(e,"runningStatus")}}},[t._v("运行状态 ")])],1)],1)],1)})),1),0==t.total?r("el-empty",{attrs:{description:"暂无数据，请添加设备"}}):t._e(),r("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.queryParams.pageNum,limit:t.queryParams.pageSize,pageSizes:[12,24,36,60]},on:{"update:page":function(e){return t.$set(t.queryParams,"pageNum",e)},"update:limit":function(e){return t.$set(t.queryParams,"pageSize",e)},pagination:t.getList}})],1)],1)},a=[],s=i("c7eb"),n=i("1da1"),u=i("ade3"),o=(i("a9e3"),i("d3b7"),i("25f0"),i("584f")),l=i("10f3"),c=i("f5a7"),d={name:"Device",dicts:["iot_device_status","iot_is_enable","iot_location_way"],components:{},data:function(){var t;return{loading:!0,total:0,deviceList:[],myGroupList:[],baseUrl:"/prod-api",queryParams:(t={pageNum:1,pageSize:12,deviceName:null,productId:null,groupId:null},Object(u["a"])(t,"groupId",null),Object(u["a"])(t,"productName",null),Object(u["a"])(t,"userId",null),Object(u["a"])(t,"userName",null),Object(u["a"])(t,"tenantId",null),Object(u["a"])(t,"tenantName",null),Object(u["a"])(t,"serialNumber",null),Object(u["a"])(t,"status",null),Object(u["a"])(t,"networkAddress",null),Object(u["a"])(t,"activeTime",null),t)}},created:function(){var t=this.$route.query.productId;null!=t&&(this.queryParams.productId=Number(t),this.queryParams.groupId=null,this.queryParams.serialNumber=null);var e=this.$route.query.groupId;null!=e&&(this.queryParams.groupId=Number(e),this.queryParams.productId=null,this.queryParams.serialNumber=null);var i=this.$route.query.sn;null!=i&&(this.queryParams.serialNumber=i,this.queryParams.productId=null,this.queryParams.groupId=null),this.connectMqtt()},activated:function(){var t=this.$route.query.t;if(null!=t&&t!=this.uniqueId){this.uniqueId=t;var e=this.$route.query.pageNum;null!=e&&(this.queryParams.pageNum=Number(e));var i=this.$route.query.productId;null!=i&&(this.queryParams.productId=Number(i),this.queryParams.groupId=null,this.queryParams.serialNumber=null);var r=this.$route.query.groupId;null!=r&&(this.queryParams.groupId=Number(r),this.queryParams.productId=null,this.queryParams.serialNumber=null);var a=this.$route.query.sn;null!=a&&(this.queryParams.serialNumber=a,this.queryParams.productId=null,this.queryParams.groupId=null),this.getList()}},methods:{connectMqtt:function(){var t=this;return Object(n["a"])(Object(s["a"])().mark((function e(){return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null!=t.$mqttTool.client){e.next=3;break}return e.next=3,t.$mqttTool.connect();case 3:t.mqttCallback(),t.getList();case 5:case"end":return e.stop()}}),e)})))()},mqttCallback:function(){var t=this;this.$mqttTool.client.on("message",(function(e,i,r){var a=e.split("/"),s=(a[1],a[2]);if(i=JSON.parse(i.toString()),i&&"status"==a[3]){console.log("接收到【设备状态】主题：",e),console.log("接收到【设备状态】内容：",i);for(var n=0;n<t.deviceList.length;n++)if(t.deviceList[n].serialNumber==s)return t.deviceList[n].status=i.status,t.deviceList[n].isShadow=i.isShadow,void(t.deviceList[n].rssi=i.rssi)}}))},mqttSubscribe:function(t){for(var e=[],i=0;i<t.length;i++){var r="/"+t[i].productId+"/"+t[i].serialNumber+"/status/post";e.push(r)}this.$mqttTool.subscribe(e)},getGroupList:function(){var t=this;this.loading=!0;var e={pageSize:30,pageNum:1,userId:this.$store.state.user.userId};Object(l["e"])(e).then((function(e){t.myGroupList=e.rows}))},getList:function(){var t=this;this.loading=!0,this.queryParams.params={},this.getGroupList(),Object(o["k"])(this.queryParams).then((function(e){t.deviceList=e.rows,t.total=e.total,t.deviceList&&t.deviceList.length>0&&t.mqttSubscribe(t.deviceList),t.loading=!1}))},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.queryParams.productId=null,this.queryParams.groupId=null,this.queryParams.serialNumber=null,this.resetForm("queryForm"),this.handleQuery()},handleEditDevice:function(t,e){var i=0;0!=t&&(i=t.deviceId||this.ids),this.$router.push({path:"/iot/device-edit",query:{deviceId:i,pageNum:this.queryParams.pageNum,activeName:e}})},handleDelete:function(t){var e=this,i=t.deviceId||this.ids;this.$modal.confirm('是否确认删除设备编号为"'+i+'"的数据项？').then((function(){return 3===t.deviceType&&Object(c["a"])(t.serialNumber),Object(o["b"])(i)})).then((function(){e.getList(),e.$modal.msgSuccess("删除成功")})).catch((function(){}))},shadowUnEnable:function(t,e){return 3!=t.status&&0==t.isShadow||!!e.isReadonly}}},m=d,p=(i("bc98"),i("2877")),h=Object(p["a"])(m,r,a,!1,null,"4799c59b",null);e["default"]=h.exports},c59e:function(t,e,i){t.exports=i.p+"static/img/video.fb1e1b71.png"},f5a7:function(t,e,i){"use strict";i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return n}));var r=i("b775");function a(t){return Object(r["a"])({url:"/sip/device/sipid/"+t,method:"delete"})}function s(t,e,i){return Object(r["a"])({url:"/sip/ptz/direction/"+t+"/"+e,method:"post",data:i})}function n(t,e,i){return Object(r["a"])({url:"/sip/ptz/scale/"+t+"/"+e,method:"post",data:i})}}}]);