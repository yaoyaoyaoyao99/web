(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0abff8"],{1850:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{"padding-left":"20px"}},[s("el-row",{staticClass:"mb8",attrs:{gutter:10}},[s("el-col",{attrs:{span:1.5}},[s("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:alert:add"],expression:"['iot:alert:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"mini"},on:{click:e.handleAdd}},[e._v("新增")])],1),s("el-col",{attrs:{span:1.5}},[s("el-button",{attrs:{type:"warning",plain:"",icon:"el-icon-refresh",size:"mini"},on:{click:e.getList}},[e._v("刷新")])],1)],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.alertList,border:"",size:"mini"},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{label:"告警名称",align:"center",prop:"alertName"}}),s("el-table-column",{attrs:{label:"状态",align:"center",prop:"status",width:"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.status?s("el-tag",{attrs:{type:"success",size:"small"}},[e._v("启动")]):e._e(),2==t.row.status?s("el-tag",{attrs:{type:"danger",size:"small"}},[e._v("暂停")]):e._e()]}}])}),s("el-table-column",{attrs:{label:"告警级别",align:"center",prop:"alertLevel",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("dict-tag",{attrs:{options:e.dict.type.iot_alert_level,value:t.row.alertLevel,size:"small"}})]}}])}),s("el-table-column",{attrs:{label:"消息通知",align:"center",prop:"messageType",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticStyle:{color:"#999"},domProps:{innerHTML:e._s(e.formatMessageTypeDisplay(t.row.messageType))}})]}}])}),s("el-table-column",{attrs:{label:"触发器",align:"left","header-align":"center",prop:"triggers","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticStyle:{overflow:"hidden","white-space":"nowrap"},domProps:{innerHTML:e._s(e.formatTriggersDisplay(t.row.triggers))}})]}}])}),s("el-table-column",{attrs:{label:"执行动作",align:"left","header-align":"center",prop:"actions"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticStyle:{overflow:"hidden","white-space":"nowrap"},domProps:{innerHTML:e._s(e.formatActionsDisplay(t.row.actions))}})]}}])}),s("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(e.parseTime(t.row.createTime,"{y}-{m}-{d}")))])]}}])}),s("el-table-column",{attrs:{label:"操作",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:alert:edit"],expression:"['iot:alert:edit']"}],attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(s){return e.handleUpdate(t.row)}}},[e._v("修改")]),s("br"),s("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:alert:remove"],expression:"['iot:alert:remove']"}],attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(s){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),s("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}),s("el-dialog",{attrs:{title:e.title,visible:e.open,width:"900px","append-to-body":""},on:{"update:visible":function(t){e.open=t}}},[s("div",{staticClass:"el-divider el-divider--horizontal",staticStyle:{"margin-top":"-25px"}}),s("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"90px"}},[s("el-row",{attrs:{gutter:50}},[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"告警名称",prop:"alertName"}},[s("el-input",{attrs:{placeholder:"请输入告警名称"},model:{value:e.form.alertName,callback:function(t){e.$set(e.form,"alertName",t)},expression:"form.alertName"}})],1),s("el-form-item",{attrs:{label:"告警级别",prop:"alertLevel"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择告警级别"},model:{value:e.form.alertLevel,callback:function(t){e.$set(e.form,"alertLevel",t)},expression:"form.alertLevel"}},e._l(e.dict.type.iot_alert_level,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:parseInt(e.value)}})})),1)],1),s("el-form-item",{attrs:{label:"告警状态"}},[s("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}})],1)],1),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"消息通知",prop:"messageType"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择"},on:{"remove-tag":e.removeMessageTypeTag},model:{value:e.form.messageType,callback:function(t){e.$set(e.form,"messageType",t)},expression:"form.messageType"}},e._l(e.messageTypeoptions,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),s("el-form-item",{attrs:{label:"备注信息",prop:"remark"}},[s("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",rows:"3"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)],1),s("el-divider"),s("el-form-item",{attrs:{label:"",prop:"triggers"}},[s("el-tooltip",{staticClass:"item",attrs:{slot:"label",effect:"dark",content:"满足任意一个条件触发",placement:"right-start"},slot:"label"},[s("span",[e._v("触发器 "),s("i",{staticClass:"el-icon-question"})])]),e._l(e.formJson.triggers,(function(t,i){return s("div",{key:i,staticStyle:{"margin-bottom":"15px",padding:"10px","background-color":"#f8f8f8","border-radius":"5px"}},[s("el-row",[s("el-col",{attrs:{span:4}},[s("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:function(t){return e.changeTriggerSource(t,i)}},model:{value:t.source,callback:function(s){e.$set(t,"source",s)},expression:"item.source"}},e._l(e.triggerSource,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),0!=i?s("el-col",{attrs:{span:2,offset:18}},[s("el-button",{staticStyle:{padding:"5px"},attrs:{size:"small",plain:"",type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.removeTriggerItem(i)}}},[e._v("删除")])],1):e._e()],1),2==t.source?s("el-row",[s("el-col",{attrs:{span:4}},[s("el-time-picker",{staticStyle:{width:"100%"},attrs:{size:"small","value-format":"HH:mm",format:"HH:mm",placeholder:"选择时间",disabled:1==t.isAdvance},on:{change:function(t){return e.timeChange(t,i)}},model:{value:t.timerTimeValue,callback:function(s){e.$set(t,"timerTimeValue",s)},expression:"item.timerTimeValue"}})],1),s("el-col",{attrs:{span:19,offset:1}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",multiple:"",size:"small",disabled:1==t.isAdvance},on:{change:function(t){return e.weekChange(t,i)}},model:{value:t.timerWeekValue,callback:function(s){e.$set(t,"timerWeekValue",s)},expression:"item.timerWeekValue"}},e._l(e.timerWeeks,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1):e._e(),2==t.source?s("el-row",{staticStyle:{margin:"5px auto"}},[s("el-col",{attrs:{span:4}},[s("el-checkbox",{staticStyle:{width:"100%"},attrs:{"true-label":1,"false-label":0,border:"",size:"small"},on:{change:function(t){e.customerCronChange(i)}},model:{value:t.isAdvance,callback:function(s){e.$set(t,"isAdvance",s)},expression:"item.isAdvance"}},[e._v("自定义CRON")])],1),s("el-col",{staticStyle:{"padding-top":"5px"},attrs:{span:19,offset:1}},[s("el-input",{attrs:{placeholder:"cron执行表达式",disabled:0==t.isAdvance,size:"small"},model:{value:t.cronExpression,callback:function(s){e.$set(t,"cronExpression",s)},expression:"item.cronExpression"}},[s("template",{slot:"append"},[s("el-button",{attrs:{type:"primary",disabled:0==t.isAdvance},on:{click:function(s){return e.handleShowCron(t,i)}}},[e._v(" 生成表达式 "),s("i",{staticClass:"el-icon-time el-icon--right"})])],1)],2)],1)],1):e._e(),s("el-row",[s("el-col",{attrs:{span:4}},[s("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:function(t){return e.triggerTypeChange(t,i)}},model:{value:t.type,callback:function(s){e.$set(t,"type",s)},expression:"item.type"}},e._l(e.triggerTypes,(function(e,t){return s("el-option",{key:t+"type",attrs:{label:e.label,value:e.value}})})),1)],1),s("el-col",{attrs:{span:5,offset:1}},[1==t.type?s("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:function(t){return e.thingsModelTriggerItemChange(t,i)}},model:{value:t.id,callback:function(s){e.$set(t,"id",s)},expression:"item.id"}},e._l(e.thingsModel.properties,(function(e,t){return s("el-option",{key:t+"property",attrs:{label:e.name,value:e.id}})})),1):2==t.type?s("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:function(t){return e.thingsModelTriggerItemChange(t,i)}},model:{value:t.id,callback:function(s){e.$set(t,"id",s)},expression:"item.id"}},e._l(e.thingsModel.functions,(function(e,t){return s("el-option",{key:t+"func",attrs:{label:e.name,value:e.id}})})),1):3==t.type?s("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:function(t){return e.thingsModelTriggerItemChange(t,i)}},model:{value:t.id,callback:function(s){e.$set(t,"id",s)},expression:"item.id"}},e._l(e.thingsModel.events,(function(e,t){return s("el-option",{key:t+"func",attrs:{label:e.name,value:e.id}})})),1):e._e()],1),s("el-col",{attrs:{span:4,offset:1}},[1==t.type||2==t.type||3==t.type?s("el-select",{attrs:{placeholder:"请选择操作符",size:"small"},model:{value:t.operator,callback:function(s){e.$set(t,"operator",s)},expression:"item.operator"}},[s("el-option",{key:"=",attrs:{label:"等于（=）",value:"="}}),s("el-option",{key:"!=",attrs:{label:"不等于（!=）",value:"!="}}),s("el-option",{key:">",attrs:{label:"大于（>）",value:">"}}),s("el-option",{key:"<",attrs:{label:"小于（<）",value:"<"}}),s("el-option",{key:">=",attrs:{label:"大于等于（>=）",value:">="}}),s("el-option",{key:"<=",attrs:{label:"小于等于（<=）",value:"<="}}),s("el-option",{key:"contain",attrs:{label:"包含（contain）",value:"contain"}}),s("el-option",{key:"notcontain",attrs:{label:"不包含（not contain）",value:"notcontain"}})],1):e._e()],1),1==t.type||2==t.type||3==t.type?s("el-col",{attrs:{span:8,offset:1}},[!t.thingsModelItem||"integer"!=t.thingsModelItem.datatype.type&&"decimal"!=t.thingsModelItem.datatype.type?t.thingsModelItem&&"bool"==t.thingsModelItem.datatype.type?s("span",[s("el-switch",{attrs:{"active-text":t.thingsModelItem.datatype.trueText,"inactive-text":t.thingsModelItem.datatype.falseText,"active-value":"1","inactive-value":"0"},model:{value:t.value,callback:function(s){e.$set(t,"value",s)},expression:"item.value"}})],1):t.thingsModelItem&&"enum"==t.thingsModelItem.datatype.type?s("span",[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"small"},model:{value:t.value,callback:function(s){e.$set(t,"value",s)},expression:"item.value"}},e._l(t.thingsModelItem.datatype.enumList,(function(e,t){return s("el-option",{key:t+"things",attrs:{label:e.text,value:e.value}})})),1)],1):t.thingsModelItem&&"string"==t.thingsModelItem.datatype.type?s("span",[s("el-input",{attrs:{placeholder:"请输入字符串",max:t.thingsModelItem.datatype.maxLength},model:{value:t.value,callback:function(s){e.$set(t,"value",s)},expression:"item.value"}})],1):t.thingsModelItem&&"array"==t.thingsModelItem.datatype.type?s("span",[s("el-input",{attrs:{placeholder:"请输入英文逗号分隔的数组"},model:{value:t.value,callback:function(s){e.$set(t,"value",s)},expression:"item.value"}})],1):e._e():s("span",[s("el-input",{attrs:{placeholder:"值",max:t.thingsModelItem.datatype.max,min:t.thingsModelItem.datatype.min,type:"number",size:"small"},model:{value:t.value,callback:function(s){e.$set(t,"value",s)},expression:"item.value"}},[s("template",{slot:"append"},[e._v(e._s(t.thingsModelItem.datatype.unit))])],2)],1)]):e._e()],1)],1)})),s("div",[e._v("+ "),s("a",{staticStyle:{color:"#409EFF"},on:{click:function(t){return e.addTriggerItem()}}},[e._v("添加触发器")])])],2),s("el-divider"),s("el-form-item",{attrs:{label:"执行动作"}},[e._l(e.formJson.actions,(function(t,i){return s("el-row",{key:i,staticStyle:{"margin-bottom":"10px"}},[s("el-col",{attrs:{span:4}},[s("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:function(t){return e.actionTypeChange(t,i)}},model:{value:t.type,callback:function(s){e.$set(t,"type",s)},expression:"item.type"}},e._l(e.actionTypes,(function(e,t){return s("el-option",{key:t+"type",attrs:{label:e.label,value:e.value}})})),1)],1),s("el-col",{attrs:{span:5,offset:1}},[1==t.type?s("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:function(t){return e.thingsModelActionItemChange(t,i)}},model:{value:t.id,callback:function(s){e.$set(t,"id",s)},expression:"item.id"}},e._l(e.thingsModel.propertiesExceptMonitor,(function(e,t){return s("el-option",{key:t+"property",attrs:{label:e.name,value:e.id}})})),1):2==t.type?s("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:function(t){return e.thingsModelActionItemChange(t,i)}},model:{value:t.id,callback:function(s){e.$set(t,"id",s)},expression:"item.id"}},e._l(e.thingsModel.functions,(function(e,t){return s("el-option",{key:t+"func",attrs:{label:e.name,value:e.id}})})),1):e._e()],1),s("el-col",{attrs:{span:10,offset:1}},[!t.thingsModelItem||"integer"!=t.thingsModelItem.datatype.type&&"decimal"!=t.thingsModelItem.datatype.type?t.thingsModelItem&&"bool"==t.thingsModelItem.datatype.type?s("span",[s("el-switch",{attrs:{"active-text":t.thingsModelItem.datatype.trueText,"inactive-text":t.thingsModelItem.datatype.falseText,"active-value":"1","inactive-value":"0"},model:{value:t.value,callback:function(s){e.$set(t,"value",s)},expression:"item.value"}})],1):t.thingsModelItem&&"enum"==t.thingsModelItem.datatype.type?s("span",[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"small"},model:{value:t.value,callback:function(s){e.$set(t,"value",s)},expression:"item.value"}},e._l(t.thingsModelItem.datatype.enumList,(function(e,t){return s("el-option",{key:t+"things",attrs:{label:e.text,value:e.value}})})),1)],1):t.thingsModelItem&&"string"==t.thingsModelItem.datatype.type?s("span",[s("el-input",{attrs:{placeholder:"请输入字符串",max:t.thingsModelItem.datatype.maxLength},model:{value:t.value,callback:function(s){e.$set(t,"value",s)},expression:"item.value"}})],1):t.thingsModelItem&&"array"==t.thingsModelItem.datatype.type?s("span",[s("el-input",{attrs:{placeholder:"请输入英文逗号分隔的数组"},model:{value:t.value,callback:function(s){e.$set(t,"value",s)},expression:"item.value"}})],1):e._e():s("span",[s("el-input",{attrs:{placeholder:"值",max:t.thingsModelItem.datatype.max,min:t.thingsModelItem.datatype.min,type:"number",size:"small"},model:{value:t.value,callback:function(s){e.$set(t,"value",s)},expression:"item.value"}},[s("template",{slot:"append"},[e._v(e._s(t.thingsModelItem.datatype.unit))])],2)],1)]),s("el-col",{attrs:{span:2,offset:1}},[s("el-button",{staticStyle:{padding:"5px"},attrs:{size:"small",plain:"",type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.removeActionItem(i)}}},[e._v("删除")])],1)],1)})),s("div",[e._v("+ "),s("a",{staticStyle:{color:"#409EFF"},on:{click:function(t){return e.addActionItem()}}},[e._v("添加执行动作")])])],2)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary",loading:e.confirmLoading},on:{click:e.submitForm}},[e._v("确 定")]),s("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1),s("el-dialog",{staticClass:"scrollbar",attrs:{title:"Cron表达式生成器",visible:e.openCron,"append-to-body":"","destroy-on-close":""},on:{"update:visible":function(t){e.openCron=t}}},[s("crontab",{staticStyle:{"padding-bottom":"80px"},attrs:{expression:e.expression},on:{hide:function(t){e.openCron=!1},fill:e.crontabFill}})],1)],1)},n=[],o=s("5530"),a=(s("4de4"),s("d3b7"),s("d81d"),s("a9e3"),s("b0c0"),s("a15b"),s("e9c4"),s("a434"),s("4e82"),s("b775"));function r(e){return Object(a["a"])({url:"/iot/alert/list",method:"get",params:e})}function l(e){return Object(a["a"])({url:"/iot/alert/"+e,method:"get"})}function p(e){return Object(a["a"])({url:"/iot/alert",method:"post",data:e})}function d(e){return Object(a["a"])({url:"/iot/alert",method:"put",data:e})}function u(e){return Object(a["a"])({url:"/iot/alert/"+e,method:"delete"})}var c=s("01ca"),m=s("bdd0"),g={name:"device-alert",dicts:["iot_alert_level","sys_job_status"],components:{Crontab:m["a"]},props:{product:{type:Object,default:null}},watch:{product:function(e,t){var s=this;this.productInfo=e,this.productInfo&&0!=this.productInfo.productId&&(this.queryParams.productId=this.productInfo.productId,Object(c["b"])(e.productId).then((function(e){s.thingsModel=JSON.parse(e.data),s.thingsModel.propertiesExceptMonitor=s.thingsModel.properties.filter((function(e){return 0==e.isMonitor})),s.getList()})))}},data:function(){return{confirmLoading:!1,thingsModel:{},loading:!1,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,alertList:[],title:"",open:!1,openCron:!1,expression:"",triggerIndex:0,queryParams:{pageNum:1,pageSize:10,alertName:null,alertLevel:null,productId:null,productName:null},timerWeeks:[{value:1,label:"周一"},{value:2,label:"周二"},{value:3,label:"周三"},{value:4,label:"周四"},{value:5,label:"周五"},{value:6,label:"周六"},{value:7,label:"周日"}],triggerSource:[{value:1,label:"设备触发"},{value:2,label:"定时触发"}],triggerTypes:[{value:1,label:"属性"},{value:2,label:"功能"},{value:3,label:"事件"},{value:5,label:"设备上线"},{value:6,label:"设备下线"}],actionTypes:[{value:1,label:"属性"},{value:2,label:"功能"}],messageTypeoptions:[{value:"1",label:"设备告警",disabled:!0},{value:"2",label:"短信通知"},{value:"3",label:"移动端推送"}],formJson:{triggers:[{timerTimeValue:"",timerWeekValue:[1,2,3,4,5,6,7]}],actions:[]},form:{messageType:["1"]},productInfo:{},rules:{alertName:[{required:!0,message:"告警名称不能为空",trigger:"blur"}],messageType:[{required:!0,message:"消息通知不能为空",trigger:"blur"}],alertLevel:[{required:!0,message:"告警级别不能为空",trigger:"change"}],productId:[{required:!0,message:"产品ID不能为空",trigger:"blur"}],productName:[{required:!0,message:"产品名称不能为空",trigger:"blur"}]}}},created:function(){},methods:{getList:function(){var e=this;this.loading=!0,r(this.queryParams).then((function(t){e.alertList=t.rows,e.total=t.total,e.loading=!1}))},cancel:function(){this.open=!1,this.reset()},reset:function(){this.form={alertId:null,alertName:null,alertLevel:1,productId:null,productName:null,remark:null,status:1,messageType:["1"]},this.formJson={triggers:[{id:"",name:"",value:"",type:1,productId:0,productName:"",source:1,jobId:0,cronExpression:"",isAdvance:0,operator:"=",timerTimeValue:"",timerWeekValue:[1,2,3,4,5,6,7]}],actions:[]},this.resetForm("form")},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.alertId})),this.single=1!==e.length,this.multiple=!e.length},handleAdd:function(){this.reset(),this.open=!0,this.title="添加告警配置"},handleUpdate:function(e){var t=this;this.reset();var s=e.alertId||this.ids;l(s).then((function(e){t.form=e.data,t.form.messageType=t.form.messageType.split(","),t.formJson.actions=JSON.parse(t.form.actions);for(var s=0;s<t.formJson.actions.length;s++)if(1==t.formJson.actions[s].type){for(var i=0;i<t.thingsModel.properties.length;i++)if(t.formJson.actions[s].id==t.thingsModel.properties[i].id){t.formJson.actions[s].thingsModelItem=t.thingsModel.properties[i];break}}else if(2==t.formJson.actions[s].type)for(var n=0;n<t.thingsModel.functions.length;n++)if(t.formJson.actions[s].id==t.thingsModel.functions[n].id){t.formJson.actions[s].thingsModelItem=t.thingsModel.functions[n];break}t.formJson.triggers=JSON.parse(t.form.triggers);for(var o=0;o<t.formJson.triggers.length;o++){if(2==t.formJson.triggers[o].source&&0==t.formJson.triggers[o].isAdvance){var a=t.formJson.triggers[o].cronExpression.substring(12).split(",").map(Number);t.formJson.triggers[o].timerWeekValue=a;var r=t.formJson.triggers[o].cronExpression.substring(5,7)+":"+t.formJson.triggers[o].cronExpression.substring(2,4);t.$set(t.formJson.triggers[o],"timerTimeValue",r)}if(1==t.formJson.triggers[o].type){for(var l=0;l<t.thingsModel.properties.length;l++)if(t.formJson.triggers[o].id==t.thingsModel.properties[l].id){t.formJson.triggers[o].thingsModelItem=t.thingsModel.properties[l];break}}else if(2==t.formJson.triggers[o].type){for(var p=0;p<t.thingsModel.functions.length;p++)if(t.formJson.triggers[o].id==t.thingsModel.functions[p].id){t.formJson.triggers[o].thingsModelItem=t.thingsModel.functions[p];break}}else if(3==t.formJson.triggers[o].type)for(var d=0;d<t.thingsModel.events.length;d++)if(t.formJson.triggers[o].id==t.thingsModel.events[d].id){t.formJson.triggers[o].thingsModelItem=t.thingsModel.events[d];break}}t.open=!0,t.title="修改设备告警"}))},submitForm:function(){var e=this;this.$refs["form"].validate((function(t){if(t){for(var s=0;s<e.formJson.triggers.length;s++)if(4!=e.formJson.triggers[s].type&&5!=e.formJson.triggers[s].type&&6!=e.formJson.triggers[s].type){if(""==e.formJson.triggers[s].id||""==e.formJson.triggers[s].name||""==e.formJson.triggers[s].value)return void e.$modal.alertError("触发器中的选项和值不能为空");if(2==e.formJson.triggers[s].source)if(0==e.formJson.triggers[s].isAdvance){if(""==e.formJson.triggers[s].timerTimeValue||null==e.formJson.triggers[s].timerTimeValue)return void e.$modal.alertError("执行时间不能空");if(null==e.formJson.triggers[s].timerWeekValue||""==e.formJson.triggers[s].timerWeekValue)return void e.$modal.alertError("请选择要执行的星期")}else if(1==e.formJson.triggers[s].isAdvance&&""==e.formJson.triggers[s].cronExpression)return void e.$modal.alertError("cron表达式不能为空");delete e.formJson.triggers[s].thingsModelItem,delete e.formJson.triggers[s].timerTimeValue,delete e.formJson.triggers[s].timerWeekValue,delete e.formJson.triggers[s].timerWeekRepeatValue,e.formJson.triggers[s].productId=e.productInfo.productId,e.formJson.triggers[s].productName=e.productInfo.productName}for(var i=0;i<e.formJson.actions.length;i++){if(delete e.formJson.actions[i].thingsModelItem,""==e.formJson.actions[i].id||""==e.formJson.actions[i].name||""==e.formJson.actions[i].value)return void e.$modal.alertError("执行动作中的选项和值不能为空");e.formJson.actions[i].productId=e.productInfo.productId,e.formJson.actions[i].productName=e.productInfo.productName}e.form.messageType=e.form.messageType.join(","),e.form.productId=e.productInfo.productId,e.form.productName=e.productInfo.productName,e.form.triggers=JSON.stringify(e.formJson.triggers),e.form.actions=JSON.stringify(e.formJson.actions),e.confirmLoading=!0,null!=e.form.alertId?d(e.form).then((function(t){e.$modal.msgSuccess("修改成功"),e.open=!1,e.confirmLoading=!1,e.getList()})):p(e.form).then((function(t){e.$modal.msgSuccess("新增成功"),e.open=!1,e.confirmLoading=!1,e.getList()}))}}))},handleDelete:function(e){var t=this,s=e.alertId||this.ids;this.$modal.confirm('是否确认删除设备告警编号为"'+s+'"的数据项？').then((function(){return u(s)})).then((function(){t.getList(),t.$modal.msgSuccess("删除成功")})).catch((function(){}))},handleExport:function(){this.download("iot/alert/export",Object(o["a"])({},this.queryParams),"alert_".concat((new Date).getTime(),".xlsx"))},addActionItem:function(){this.formJson.actions.push({id:"",name:"",value:"",type:2})},removeActionItem:function(e){this.formJson.actions.splice(e,1)},changeTriggerSource:function(e,t){2==e&&(this.formJson.triggers[t].timerTimeValue="",this.formJson.triggers[t].timerWeekValue=[1,2,3,4,5,6,7])},addTriggerItem:function(){this.formJson.triggers.push({id:"",name:"",value:"",type:1,productId:0,productName:"",source:1,jobId:0,cronExpression:"",isAdvance:0,operator:"=",timerTimeValue:"",timerWeekValue:[1,2,3,4,5,6,7]})},removeTriggerItem:function(e){this.formJson.triggers.splice(e,1)},handleShowCron:function(e,t){this.expression=e.cronExpression,this.triggerIndex=t,this.openCron=!0},crontabFill:function(e){this.formJson.triggers[this.triggerIndex].cronExpression=e},weekChange:function(e,t){this.gentCronExpression(t)},timeChange:function(e,t){this.gentCronExpression(t)},customerCronChange:function(e,t){},gentCronExpression:function(e){var t="00",s="00";console.log("time",this.formJson.triggers[e].timerTimeValue),null!=this.formJson.triggers[e].timerTimeValue&&""!=this.formJson.triggers[e].timerTimeValue&&(t=this.formJson.triggers[e].timerTimeValue.substring(0,2),s=this.formJson.triggers[e].timerTimeValue.substring(3));var i="*";this.formJson.triggers[e].timerWeekValue.length>0&&(i=this.formJson.triggers[e].timerWeekValue.sort()),this.formJson.triggers[e].cronExpression="0 "+s+" "+t+" ? * "+i},removeMessageTypeTag:function(e){1==e&&this.form.messageType.unshift(e)},triggerTypeChange:function(e,t){this.formJson.triggers[t].id=null,this.formJson.triggers[t].thingsModelItem=null,this.formJson.triggers[t].value="",this.formJson.triggers[t].operator="="},thingsModelTriggerItemChange:function(e,t){if(this.formJson.triggers[t].value="",1==this.formJson.triggers[t].type){for(var s=0;s<this.thingsModel.properties.length;s++)if(this.thingsModel.properties[s].id==e){this.formJson.triggers[t].name=this.thingsModel.properties[s].name,this.formJson.triggers[t].thingsModelItem=this.thingsModel.properties[s];break}}else if(2==this.formJson.triggers[t].type){for(var i=0;i<this.thingsModel.functions.length;i++)if(this.thingsModel.functions[i].id==e){this.formJson.triggers[t].name=this.thingsModel.functions[i].name,this.formJson.triggers[t].thingsModelItem=this.thingsModel.functions[i];break}}else if(3==this.formJson.triggers[t].type)for(var n=0;n<this.thingsModel.events.length;n++)if(this.thingsModel.events[n].id==e){this.formJson.triggers[t].name=this.thingsModel.events[n].name,this.formJson.triggers[t].thingsModelItem=this.thingsModel.events[n];break}},actionTypeChange:function(e,t){this.formJson.actions[t].id=null,this.formJson.actions[t].value=null,this.formJson.actions[t].thingsModelItem=null},thingsModelActionItemChange:function(e,t){if(this.formJson.actions[t].value="",1==this.formJson.actions[t].type){for(var s=0;s<this.thingsModel.properties.length;s++)if(this.thingsModel.properties[s].id==e){this.formJson.actions[t].name=this.thingsModel.properties[s].name,this.formJson.actions[t].thingsModelItem=this.thingsModel.properties[s];break}}else if(2==this.formJson.actions[t].type){for(var i=0;i<this.thingsModel.functions.length;i++)if(this.thingsModel.functions[i].id==e){this.formJson.actions[t].name=this.thingsModel.functions[i].name,this.formJson.actions[t].thingsModelItem=this.thingsModel.functions[i];break}}else if(3==this.formJson.actions[t].type)for(var n=0;n<this.thingsModel.events.length;n++)if(this.thingsModel.events[n].id==e){this.formJson.actions[t].name=this.thingsModel.events[n].name,this.formJson.actions[t].thingsModelItem=this.thingsModel.events[n];break}},formatMessageTypeDisplay:function(e){for(var t=e.split(",").sort(),s="",i=0;i<t.length;i++)"1"==t[i]?s+="<span>设备告警</span><br />":"2"==t[i]?s+="<span>短信通知</span><br />":"3"==t[i]&&(s+="<span>移动端推送</span><br />");return s},formatActionsDisplay:function(e){if(null!=e&&""!=e){for(var t=JSON.parse(e),s="",i=0;i<t.length;i++){var n=t[i].value;if(1==t[i].type){for(var o=0;o<this.thingsModel.properties.length;o++)if(t[i].id==this.thingsModel.properties[o].id){if("decimal"==this.thingsModel.properties[o].datatype.type||"integer"==this.thingsModel.properties[o].datatype.type)n=t[i].value+this.thingsModel.properties[o].datatype.unit;else if("enum"==this.thingsModel.properties[o].datatype.type){for(var a=0;a<this.thingsModel.properties[o].datatype.enumList.length;a++)if(t[i].value==this.thingsModel.properties[o].datatype.enumList[a].value){n=this.thingsModel.properties[o].datatype.enumList[a].text;break}}else"bool"==this.thingsModel.properties[o].datatype.type&&(n="1"==t[i].value?this.thingsModel.properties[o].datatype.trueText:this.thingsModel.properties[o].datatype.falseText);break}}else if(2==t[i].type)for(var r=0;r<this.thingsModel.functions.length;r++)if(t[i].id==this.thingsModel.functions[r].id){if("decimal"==this.thingsModel.functions[r].datatype.type||"integer"==this.thingsModel.functions[r].datatype.type)n=t[i].value+this.thingsModel.functions[r].datatype.unit;else if("enum"==this.thingsModel.functions[r].datatype.type){for(var l=0;l<this.thingsModel.functions[r].datatype.enumList.length;l++)if(t[i].value==this.thingsModel.functions[r].datatype.enumList[l].value){n=this.thingsModel.functions[r].datatype.enumList[l].text;break}}else"bool"==this.thingsModel.functions[r].datatype.type&&(n="1"==t[i].value?this.thingsModel.functions[r].datatype.trueText:this.thingsModel.functions[r].datatype.falseText);break}s=s+t[i].name+'：<span style="color:#F56C6C">'+n+"</span><br />"}return""==s?"无":s}},formatTriggersDisplay:function(e){if(null!=e&&""!=e){for(var t=JSON.parse(e),s="",i=0;i<t.length;i++){var n=t[i].value;if(1==t[i].type){for(var o=0;o<this.thingsModel.properties.length;o++)if(t[i].id==this.thingsModel.properties[o].id){if("decimal"==this.thingsModel.properties[o].datatype.type||"integer"==this.thingsModel.properties[o].datatype.type)n=t[i].value+this.thingsModel.properties[o].datatype.unit;else if("enum"==this.thingsModel.properties[o].datatype.type){for(var a=0;a<this.thingsModel.properties[o].datatype.enumList.length;a++)if(t[i].value==this.thingsModel.properties[o].datatype.enumList[a].value){n=this.thingsModel.properties[o].datatype.enumList[a].text;break}}else"bool"==this.thingsModel.properties[o].datatype.type&&(n="1"==t[i].value?this.thingsModel.properties[o].datatype.trueText:this.thingsModel.properties[o].datatype.falseText);break}s=s+t[i].name+' <span style="color:#F56C6C">'+t[i].operator+" "+n+"</span>"}else if(2==t[i].type){for(var r=0;r<this.thingsModel.functions.length;r++)if(t[i].id==this.thingsModel.functions[r].id){if("decimal"==this.thingsModel.functions[r].datatype.type||"integer"==this.thingsModel.functions[r].datatype.type)n=t[i].value+this.thingsModel.functions[r].datatype.unit;else if("enum"==this.thingsModel.functions[r].datatype.type){for(var l=0;l<this.thingsModel.functions[r].datatype.enumList.length;l++)if(t[i].value==this.thingsModel.functions[r].datatype.enumList[l].value){n=this.thingsModel.functions[r].datatype.enumList[l].text;break}}else"bool"==this.thingsModel.functions[r].datatype.type&&(n="1"==t[i].value?this.thingsModel.functions[r].datatype.trueText:this.thingsModel.functions[r].datatype.falseText);break}s=s+t[i].name+' <span style="color:#F56C6C">'+t[i].operator+" "+n+"</span>"}else if(3==t[i].type){for(var p=0;p<this.thingsModel.events.length;p++)if(t[i].id==this.thingsModel.events[p].id){if("decimal"==this.thingsModel.events[p].datatype.type||"integer"==this.thingsModel.events[p].datatype.type)n=t[i].value+this.thingsModel.events[p].datatype.unit;else if("enum"==this.thingsModel.events[p].datatype.type){for(var d=0;d<this.thingsModel.events[p].datatype.enumList.length;d++)if(t[i].value==this.thingsModel.events[p].datatype.enumList[d].value){n=this.thingsModel.events[p].datatype.enumList[d].text;break}}else"bool"==this.thingsModel.events[p].datatype.type&&(n="1"==t[i].value?this.thingsModel.events[p].datatype.trueText:this.thingsModel.events[p].datatype.falseText);break}s=s+t[i].name+' <span style="color:#F56C6C">'+t[i].operator+" "+n+"</span>"}else 4==t[i].type?s+='<span style="color:#F56C6C">设备升级</span>':5==t[i].type?s+='<span style="color:#F56C6C">设备上线</span>':6==t[i].type&&(s+='<span style="color:#F56C6C">设备下线</span>');2==t[i].source?s=s+'<span style="margin-left:10px;color:#409EFF"><i class="el-icon-time"></i> '+t[i].cronExpression+"</span><br />":s+='<span style="margin-left:10px;color:#aaa;">设备</span><br />'}return s}}}},h=g,f=s("2877"),v=Object(f["a"])(h,i,n,!1,null,null,null);t["default"]=v.exports}}]);