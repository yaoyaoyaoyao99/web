(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-366da212"],{"0878":function(e,t,i){},"5eb3":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"components-container"},[i("el-row",[i("span",{staticStyle:{overflow:"auto"}},[e._v("选择录像日期：")]),e.videoVod?i("el-date-picker",{attrs:{type:"date",size:"small",clearable:"",placeholder:"选择日期"},on:{change:e.loadDevRecord},model:{value:e.queryDate,callback:function(t){e.queryDate=t},expression:"queryDate"}}):e._e()],1),i("el-divider"),i("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.playerLoading,expression:"playerLoading"}]},[i("div",{staticClass:"player-wrapper",staticStyle:{"margin-top":"-20px"}},[i("div",{ref:"player",staticClass:"player"},[i("div",{staticClass:"container-shell"},[i("div",{ref:"container",attrs:{id:"container"}})])]),i("div",{staticClass:"player-display"})]),i("el-col",{attrs:{span:24}},[i("el-row",{staticClass:"ctrl ctrl-btn",attrs:{type:"flex",align:"middle"}},[i("el-col",{staticStyle:{overflow:"auto",display:"flex"},attrs:{span:24,xs:24,sm:24}},[e.playing?e._e():i("el-button",{staticClass:"comm-margin",attrs:{type:"primary",icon:"el-icon-video-play",size:"small"},on:{click:e.preparePlay}},[e._v("播放")]),e.playing?i("el-button",{staticClass:"comm-margin",attrs:{type:"danger",icon:"el-icon-video-pause",size:"small"},on:{click:e.stopPlay}},[e._v("停止")]):e._e(),e.quieting?e._e():i("el-button",{staticClass:"comm-margin",attrs:{icon:"el-icon-close-notification",size:"small",type:"info"},on:{click:e.mute}},[e._v("静音")]),e.quieting?i("el-button",{staticClass:"hidden-xs-only comm-margin",attrs:{icon:"el-icon-bell",size:"small",type:"warning"},on:{click:e.cancelMute}},[e._v("放音")]):e._e(),i("el-slider",{staticClass:"hidden-xs-only",staticStyle:{width:"100px",margin:"0 30px 0 0"},attrs:{disabled:e.quieting,"format-tooltip":e.formatVolumeToolTip},on:{change:e.changeVolume},model:{value:e.volume,callback:function(t){e.volume=t},expression:"volume"}}),i("el-button",{staticClass:"hidden-xs-only",attrs:{icon:"el-icon-full-screen",size:"small"},on:{click:e.fullscreen}},[e._v("全屏")]),i("el-button",{attrs:{icon:"el-icon-camera-solid",size:"small"},on:{click:e.screenShot}},[e._v("截图")]),e.pausing?i("el-button",{staticClass:"comm-margin",attrs:{type:"primary",icon:"el-icon-video-play",size:"small",disabled:!e.playing},on:{click:e.resume}},[e._v("恢复")]):e._e(),e.pausing?e._e():i("el-button",{staticClass:"comm-margin",attrs:{type:"danger",icon:"el-icon-video-pause",size:"small",disabled:!e.playing},on:{click:e.pause}},[e._v("暂停")])],1)],1)],1)],1)],1)},s=[],a=(i("4de4"),i("d3b7"),i("a9e3"),i("ed08"),i("e05f"),i("e2de")),l=i("6827"),o={name:"Video",jessibuca:null,data:function(){return{defaultProps:{children:"children",label:"label"},RecordSn:"",expandIds:[],filterText:"",groupLoading:!1,groupData:[],selectData:{},treeVisible:!1,curInfo:"",protocolFlag:!0,selectDeviceId:"34020000001320000003",selectChannelId:"34020000001320000002",channelData:[],videoVod:!0,vodIndex:0,vodData:{},playerLoading:!1,url:{ssrc:"",flv:""},hisData:[],queryDate:"",playing:!1,quieting:!0,pausing:!1,paused:!1,volume:100,speed:1,orientation:1}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},mounted:function(){this.expandIds=["0"],this.create()},beforeDestroy:function(){this.cleanPlayer(!0)},methods:{loadChannelData:function(){this.channelData=null;var e=channelData.split("_");this.selectDeviceId=e[0],this.selectChannelId=e[1]},create:function(){var e=document.body.clientWidth<720,t=new window.Jessibuca({container:this.$refs.container,videoBuffer:Number(.2),decoder:"/js/jessibuca/decoder.js",timeout:20,debug:!0,isResize:!1,loadingText:"加载中",isFlv:!0,showBandwidth:!0,supportDblclickFullscreen:!0,operateBtns:{fullscreen:e,screenshot:!1,play:!1,audio:!1},forceNoOffscreen:!0,isNotMute:!1,playbackForwardMaxRateDecodeIFrame:4,playbackCurrentTimeMove:!1});this.$options.jessibuca=t;var i=this;t.on("error",(function(e){console.log("error"),console.log(e),i.destroy()})),t.on("pause",(function(e){console.log("pause success!"),console.log(e)})),t.on("stats",(function(e){console.log("stats is",e)})),t.on("timeout",(function(){console.log("timeout"),i.destroy(),i.retryCount<=1&&(i.startPlay(i.url),i.retryCount++)}));var n=0,s=0;t.on("timeUpdate",(function(e){s=parseInt(e/6e4),n!==s&&n++})),this.videoVod&&t.on("playbackSeek",(function(e){i.seekPlay(e)}))},destroy:function(){console.log("destroy"),this.$options.jessibuca&&this.$options.jessibuca.destroy(),this.create()},preparePlay:function(){this.cleanPlayer(!1),this.loadDevRecord()},cleanPlayer:function(e){this.destroy(),e&&this.stopPlay()},mute:function(){this.playing&&(this.$options.jessibuca.mute(),this.quieting=!0)},cancelMute:function(){this.playing&&(this.$options.jessibuca.cancelMute(),this.quieting=!1)},formatVolumeToolTip:function(e){return"音量条: "+e},changeVolume:function(){this.$options.jessibuca.setVolume(this.volume/100)},screenShot:function(){this.playing&&this.$options.jessibuca.screenshot()},fullscreen:function(){this.playing&&(this.fullscreening=!this.fullscreening,this.$options.jessibuca.setFullscreen(this.fullscreening))},initUrl:function(e){e?(this.url.ssrc=e.streamId,this.url.flv=e.flv):(this.url.ssrc="",this.url.flv="")},triggerPlay:function(e){var t=this;this.playing?(clearTimeout(this.timer),this.$options.jessibuca.on("play",(function(){t.quieting=t.$options.jessibuca.quieting})),this.videoVod&&(this.$options.jessibuca.playback(this.url.flv,{playList:e,fps:20}),this.timer=setTimeout((function(){t.playerLoading=!1}),2e3))):this.playerLoading=!1},play:function(e){var t=this;if(this.selectDeviceId&&this.selectChannelId)if(this.playerLoading=!0,this.pausing=!1,this.url.ssrc)Object(a["k"])(this.selectDeviceId,this.selectChannelId).then((function(i){var n={start:t.vodData.start,end:t.vodData.end};Object(a["f"])(t.selectDeviceId,t.selectChannelId,n).then((function(e){t.playing=!0,t.initUrl(e.data)})).finally((function(){t.triggerPlay(e)}))})).catch((function(){t.playerLoading=!1}));else{var i={start:this.vodData.start,end:this.vodData.end};Object(a["f"])(this.selectDeviceId,this.selectChannelId,i).then((function(e){console.log(e),t.playing=!0,t.initUrl(e.data)})).finally((function(){t.triggerPlay(e)}))}},playNext:function(e){var t=this;this.playerLoading=!0,this.url.flv="",Object(a["k"])(this.selectDeviceId,this.selectChannelId).then((function(e){t.playing=!1,t.url.ssrc=""})).finally((function(){t.playerLoading=!1}))},scalePlay:function(){var e=this;this.url.ssrc&&this.playing&&Object(a["j"])(this.selectDeviceId,this.selectChannelId,this.speed).then((function(t){e.$refs.player.scale(e.speed)}))},seekPlay:function(e){var t=this,i=this.vodData.base+3600*e.hour+60*e.min+e.second,n=i-this.vodData.start;if(this.url.ssrc&&this.playing){var s={seek:n};Object(a["i"])(this.selectDeviceId,this.selectChannelId,s).then((function(e){t.$options.jessibuca.setPlaybackStartTime(i)}))}},pause:function(){var e=this;this.url.ssrc&&this.playing&&(this.videoVod?Object(a["g"])(this.selectDeviceId,this.selectChannelId).then((function(t){1===t.code&&(e.pausing=!0,e.$options.jessibuca.pause())})):(this.$options.jessibuca.pause(),this.pausing=!0))},resume:function(){var e=this;this.url.ssrc&&this.pausing&&Object(a["h"])(this.selectDeviceId,this.selectChannelId).then((function(t){"no channel info"===t.data?(e.pausing=!1,e.play()):(e.$options.jessibuca.play(),e.pausing=!1)}))},isPause:function(e){this.paused=e},stopPlay:function(){var e=this;this.url.ssrc&&this.playing&&(this.playerLoading=!0,this.pausing=!1,this.url.flv="",Object(a["k"])(this.selectDeviceId,this.selectChannelId).then((function(t){e.playing=!1,e.$options.jessibuca&&(e.retryCount=0,e.destroy()),e.url.ssrc=""})).finally((function(){e.playerLoading=!1})))},changeSpeed:function(){this.speed!==val&&(this.speed=val,this.scalePlay())},loadDevRecord:function(){var e=this;if(this.selectDeviceId&&this.selectChannelId){var t=this.queryDate?new Date(this.queryDate).getTime():new Date((new Date).toLocaleDateString()).getTime(),i=t/1e3,n=Math.floor((t+864e5-1)/1e3),s={start:i,end:n};Object(l["a"])(this.selectDeviceId,this.selectChannelId,s).then((function(t){if(e.hisData=t.data.recordItems,t.data.recordItems){var s=e.hisData.length;s>0?(e.hisData[0].start<i?(e.vodData={start:i,end:n,base:i},e.hisData[0].start=i):e.vodData={start:e.hisData[0].start,end:n,base:i},e.play(e.hisData)):e.$message({type:"warning",message:"当前通道没有录像"})}else e.$message({type:"warning",message:"当前通道没有录像"})})).catch((function(){e.playerLoading=!1}))}}}},c=o,r=(i("8557"),i("a5e2"),i("2877")),u=Object(r["a"])(c,n,s,!1,null,"3ee6f4e8",null);t["default"]=u.exports},6827:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("b775");function s(e,t,i){return Object(n["a"])({url:"/sip/record/devquery/"+e+"/"+t,method:"get",params:i})}},8557:function(e,t,i){"use strict";i("0878")},"9c37":function(e,t,i){},a5e2:function(e,t,i){"use strict";i("9c37")},e2de:function(e,t,i){"use strict";i.d(t,"e",(function(){return s})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return o})),i.d(t,"l",(function(){return c})),i.d(t,"m",(function(){return r})),i.d(t,"d",(function(){return u})),i.d(t,"f",(function(){return d})),i.d(t,"k",(function(){return h})),i.d(t,"g",(function(){return p})),i.d(t,"h",(function(){return f})),i.d(t,"i",(function(){return y})),i.d(t,"j",(function(){return g}));var n=i("b775");function s(e){return Object(n["a"])({url:"/sip/channel/list",method:"get",params:e})}function a(e){return Object(n["a"])({url:"/sip/channel/"+e,method:"get"})}function l(e,t){return Object(n["a"])({url:"/sip/channel/"+e,method:"post",data:t})}function o(e){return Object(n["a"])({url:"/sip/channel/"+e,method:"delete"})}function c(e,t){return Object(n["a"])({url:"/sip/player/play/"+e+"/"+t,method:"get"})}function r(e,t,i){return Object(n["a"])({url:"/sip/player/playstop/"+e+"/"+t+"/"+i,method:"get"})}function u(e,t){return Object(n["a"])({url:"/sip/player/playstream/"+e+"/"+t,method:"get"})}function d(e,t,i){return Object(n["a"])({url:"/sip/player/playback/"+e+"/"+t,method:"get",params:i})}function h(e,t,i){return Object(n["a"])({url:"/sip/player/playbackStop/"+e+"/"+t+"/"+i,method:"get"})}function p(e,t,i){return Object(n["a"])({url:"/sip/player/playbackPause/"+e+"/"+t+"/"+i,method:"get"})}function f(e,t,i){return Object(n["a"])({url:"/sip/player/playbackReplay/"+e+"/"+t+"/"+i,method:"get"})}function y(e,t,i,s){return Object(n["a"])({url:"/sip/player/playbackSeek/"+e+"/"+t+"/"+i,method:"get",params:s})}function g(e,t,i,s){return Object(n["a"])({url:"/sip/player/playbackSpeed/"+e+"/"+t+"/"+i,method:"get",params:s})}}}]);