(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4c14e16c","chunk-51b2ff9c","chunk-47058647","chunk-b2bd8bd6"],{1464:function(e,t,r){"use strict";r("7a34")},"14a0":function(e,t,r){"use strict";r("dc57")},"1e36":function(e,t,r){"use strict";r.d(t,"d",(function(){return a})),r.d(t,"e",(function(){return o})),r.d(t,"c",(function(){return n})),r.d(t,"a",(function(){return l})),r.d(t,"f",(function(){return s})),r.d(t,"b",(function(){return c}));var i=r("b775");function a(e){return Object(i["a"])({url:"/iot/category/list",method:"get",params:e})}function o(){return Object(i["a"])({url:"/iot/category/shortlist",method:"get"})}function n(e){return Object(i["a"])({url:"/iot/category/"+e,method:"get"})}function l(e){return Object(i["a"])({url:"/iot/category",method:"post",data:e})}function s(e){return Object(i["a"])({url:"/iot/category",method:"put",data:e})}function c(e){return Object(i["a"])({url:"/iot/category/"+e,method:"delete"})}},3021:function(e,t,r){"use strict";r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return o})),r.d(t,"d",(function(){return n})),r.d(t,"b",(function(){return l}));var i=r("b775");function a(e,t){return Object(i["a"])({url:"/sip/sipconfig/"+e+"/"+t,method:"get"})}function o(e){return Object(i["a"])({url:"/sip/sipconfig",method:"post",data:e})}function n(e){return Object(i["a"])({url:"/sip/sipconfig",method:"put",data:e})}function l(e){return Object(i["a"])({url:"/sip/sipconfig/product/"+e,method:"delete"})}},"447d":function(e,t,r){},"4efc":function(e,t,r){e.exports=r.p+"static/img/gateway.5a51e30f.png"},"52bb":function(e,t,r){e.exports=r.p+"static/img/product.66c3c4d5.png"},"584f":function(e,t,r){"use strict";r.d(t,"l",(function(){return a})),r.d(t,"j",(function(){return o})),r.d(t,"k",(function(){return n})),r.d(t,"i",(function(){return l})),r.d(t,"e",(function(){return s})),r.d(t,"c",(function(){return c})),r.d(t,"f",(function(){return u})),r.d(t,"h",(function(){return d})),r.d(t,"g",(function(){return m})),r.d(t,"a",(function(){return p})),r.d(t,"m",(function(){return f})),r.d(t,"b",(function(){return h})),r.d(t,"d",(function(){return v}));var i=r("b775");function a(e){return Object(i["a"])({url:"/iot/device/unAuthlist",method:"get",params:e})}function o(e){return Object(i["a"])({url:"/iot/device/listByGroup",method:"get",params:e})}function n(e){return Object(i["a"])({url:"/iot/device/shortList",method:"get",params:e})}function l(){return Object(i["a"])({url:"/iot/device/all",method:"get"})}function s(e){return Object(i["a"])({url:"/iot/device/"+e,method:"get"})}function c(e){return Object(i["a"])({url:"/iot/device/synchronization/"+e,method:"get"})}function u(e){return Object(i["a"])({url:"/iot/device/getDeviceBySerialNumber/"+e,method:"get"})}function d(){return Object(i["a"])({url:"/iot/device/statistic",method:"get"})}function m(e){return Object(i["a"])({url:"/iot/device/runningStatus/"+e,method:"get"})}function p(e){return Object(i["a"])({url:"/iot/device",method:"post",data:e})}function f(e){return Object(i["a"])({url:"/iot/device",method:"put",data:e})}function h(e){return Object(i["a"])({url:"/iot/device/"+e,method:"delete"})}function v(){return Object(i["a"])({url:"/iot/device/generator",method:"get"})}},"7a34":function(e,t,r){},"814a":function(e,t,r){"use strict";r.d(t,"e",(function(){return a})),r.d(t,"d",(function(){return o})),r.d(t,"c",(function(){return n})),r.d(t,"a",(function(){return l})),r.d(t,"f",(function(){return s})),r.d(t,"b",(function(){return c}));var i=r("b775");function a(e){return Object(i["a"])({url:"/iot/firmware/list",method:"get",params:e})}function o(e){return Object(i["a"])({url:"/iot/firmware/getLatest/"+e,method:"get"})}function n(e){return Object(i["a"])({url:"/iot/firmware/"+e,method:"get"})}function l(e){return Object(i["a"])({url:"/iot/firmware",method:"post",data:e})}function s(e){return Object(i["a"])({url:"/iot/firmware",method:"put",data:e})}function c(e){return Object(i["a"])({url:"/iot/firmware/"+e,method:"delete"})}},9355:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{"padding-left":"20px"}},[r("el-row",{staticClass:"mb8",attrs:{gutter:10}},[r("el-col",{attrs:{span:1.5}},[r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:firmware:add"],expression:"['iot:firmware:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"mini"},on:{click:e.handleAdd}},[e._v("新增")])],1),r("el-col",{attrs:{span:1.5}},[r("el-button",{attrs:{type:"warning",plain:"",icon:"el-icon-refresh",size:"mini"},on:{click:e.getList}},[e._v("刷新")])],1)],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.firmwareList,size:"small"},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{label:"固件名称",align:"center",prop:"firmwareName"}}),r("el-table-column",{attrs:{label:"固件版本",align:"center",prop:"version",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v("Version ")]),e._v(" "+e._s(t.row.version)+" ")]}}])}),r("el-table-column",{attrs:{label:"状态",align:"center",prop:"isLatest",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.isLatest?r("el-tag",{attrs:{type:"success"}},[e._v("最新")]):r("el-tag",{attrs:{type:"info"}},[e._v("默认")])]}}])}),r("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.parseTime(t.row.createTime,"{y}-{m}-{d}")))])]}}])}),r("el-table-column",{attrs:{label:"下载地址",align:"center",prop:"filePath","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-link",{attrs:{href:e.getDownloadUrl(t.row.filePath),underline:!1,type:"success"}},[e._v(e._s(e.getDownloadUrl(t.row.filePath)))])]}}])}),r("el-table-column",{attrs:{label:"固件描述",align:"center",prop:"remark","min-width":"200"}}),r("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:firmware:edit"],expression:"['iot:firmware:edit']"}],staticStyle:{padding:"5px"},attrs:{size:"small",type:"primary",icon:"el-icon-edit"},on:{click:function(r){return e.handleUpdate(t.row)}}},[e._v("修改")]),r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:firmware:remove"],expression:"['iot:firmware:remove']"}],staticStyle:{padding:"5px"},attrs:{size:"small",type:"danger",icon:"el-icon-delete"},on:{click:function(r){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),r("el-dialog",{attrs:{title:e.title,visible:e.open,width:"500px","append-to-body":""},on:{"update:visible":function(t){e.open=t}}},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"固件名称",prop:"firmwareName"}},[r("el-input",{attrs:{placeholder:"请输入固件名称"},model:{value:e.form.firmwareName,callback:function(t){e.$set(e.form,"firmwareName",t)},expression:"form.firmwareName"}})],1),r("el-form-item",{attrs:{label:"固件版本",prop:"version"}},[r("el-input",{attrs:{placeholder:"请输入固件版本",type:"number",step:"0.1"},model:{value:e.form.version,callback:function(t){e.$set(e.form,"version",t)},expression:"form.version"}})],1),r("el-form-item",{attrs:{label:"最新固件",prop:"isLatest"}},[r("el-switch",{attrs:{"active-text":"","inactive-text":"","active-value":1,"inactive-value":0},model:{value:e.form.isLatest,callback:function(t){e.$set(e.form,"isLatest",t)},expression:"form.isLatest"}}),r("el-link",{staticStyle:{"font-size":"12px","margin-left":"15px"},attrs:{type:"info",underline:!1}},[e._v("提示：产品中只能有一个最新固件")])],1),r("el-form-item",{attrs:{label:"固件上传",prop:"filePath"}},[r("fileUpload",{ref:"file-upload",attrs:{value:e.form.filePath,limit:1,fileSize:10,fileType:["bin","zip","pdf"]},on:{input:function(t){return e.getFilePath(t)}}})],1),r("el-form-item",{attrs:{label:"固件描述",prop:"remark"}},[r("el-input",{attrs:{type:"textarea",rows:"4",placeholder:"请输入固件信息"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")]),r("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1)],1)},a=[],o=r("5530"),n=(r("d81d"),r("2a75")),l=r("814a"),s=r("5f87"),c={name:"product-firmware",dicts:["iot_yes_no"],components:{fileUpload:n["a"]},props:{product:{type:Object,default:null}},watch:{product:function(e,t){this.productInfo=e,this.productInfo&&0!=this.productInfo.productId&&(this.queryParams.productId=this.productInfo.productId,this.form.productId=this.productInfo.productId,this.form.productName=this.productInfo.productName,this.getList())}},data:function(){return{loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,firmwareList:[],title:"",open:!1,queryParams:{pageNum:1,pageSize:100,firmwareName:null,productName:null,productId:0,isSys:null},productInfo:{},form:{version:1},rules:{firmwareName:[{required:!0,message:"固件名称不能为空",trigger:"blur"}],version:[{required:!0,message:"固件版本不能为空",trigger:"blur"}],filePath:[{required:!0,message:"文件路径不能为空",trigger:"blur"}]},upload:{isUploading:!1,headers:{Authorization:"Bearer "+Object(s["a"])()},url:"/prod-api/iot/tool/upload",fileList:[]}}},created:function(){},methods:{getDownloadUrl:function(e){return window.location.origin+"/prod-api"+e},getList:function(){var e=this;this.loading=!0,Object(l["e"])(this.queryParams).then((function(t){e.firmwareList=t.rows,e.total=t.total,e.loading=!1}))},cancel:function(){this.open=!1,this.reset()},reset:function(){this.form={firmwareId:null,firmwareName:null,tenantId:null,tenantName:null,productId:this.form.productId,productName:this.form.productName,isSys:null,isLatest:0,version:1,filePath:null,delFlag:null,createBy:null,createTime:null,updateBy:null,updateTime:null,remark:null},this.resetForm("form")},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.firmwareId})),this.single=1!==e.length,this.multiple=!e.length},handleAdd:function(){this.reset(),this.open=!0,this.title="添加产品固件",this.upload.fileList=[]},handleUpdate:function(e){var t=this;this.reset();var r=e.firmwareId||this.ids;Object(l["c"])(r).then((function(e){t.form=e.data,t.open=!0,t.title="修改产品固件",t.upload.fileList=[{name:t.form.firmwareName,url:t.form.filePath}]}))},submitForm:function(){var e=this;this.$refs["form"].validate((function(t){t&&(null!=e.form.firmwareId?Object(l["f"])(e.form).then((function(t){e.$modal.msgSuccess("修改成功"),e.open=!1,e.getList()})):Object(l["a"])(e.form).then((function(t){e.$modal.msgSuccess("新增成功"),e.open=!1,e.getList()})))}))},handleDelete:function(e){var t=this,r=e.firmwareId||this.ids;this.$modal.confirm('是否确认删除产品固件编号为"'+r+'"的数据项？').then((function(){return Object(l["b"])(r)})).then((function(){t.getList(),t.$modal.msgSuccess("删除成功")})).catch((function(){}))},handleExport:function(){this.download("iot/firmware/export",Object(o["a"])({},this.queryParams),"firmware_".concat((new Date).getTime(),".xlsx"))},getFilePath:function(e){this.form.filePath=e},submitUpload:function(){this.$refs.upload.submit()},handleFileUploadProgress:function(e,t,r){this.upload.isUploading=!0},handleFileSuccess:function(e,t,r){this.upload.isUploading=!1,this.form.filePath=e.url,this.$modal.msgSuccess(e.msg)},handleDownload:function(e){window.open("/prod-api"+e.filePath)}}},u=c,d=r("2877"),m=Object(d["a"])(u,i,a,!1,null,null,null);t["default"]=m.exports},"9b9c":function(e,t,r){"use strict";r.d(t,"f",(function(){return a})),r.d(t,"g",(function(){return o})),r.d(t,"e",(function(){return n})),r.d(t,"a",(function(){return l})),r.d(t,"h",(function(){return s})),r.d(t,"d",(function(){return c})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return d}));var i=r("b775");function a(e){return Object(i["a"])({url:"/iot/product/list",method:"get",params:e})}function o(){return Object(i["a"])({url:"/iot/product/shortList",method:"get"})}function n(e){return Object(i["a"])({url:"/iot/product/"+e,method:"get"})}function l(e){return Object(i["a"])({url:"/iot/product",method:"post",data:e})}function s(e){return Object(i["a"])({url:"/iot/product",method:"put",data:e})}function c(e){return Object(i["a"])({url:"/iot/product/deviceCount/"+e,method:"get"})}function u(e){return Object(i["a"])({url:"/iot/product/status/",method:"put",data:e})}function d(e){return Object(i["a"])({url:"/iot/product/"+e,method:"delete"})}},b690:function(e,t,r){"use strict";r("447d")},bbfb:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{"padding-left":"20px"}},[r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:14}},[r("el-row",{staticClass:"mb8",attrs:{gutter:10}},[r("el-col",{attrs:{span:1.5}},[r("el-button",{attrs:{type:"warning",plain:"",icon:"el-icon-refresh",size:"mini"},on:{click:e.getList}},[e._v("刷新")])],1),r("el-tag",{staticStyle:{"margin-left":"15px"},attrs:{type:"danger"}},[e._v("该功能暂不可用,后面版本发布")])],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{"margin-bottom":"60px","margin-top":"20px"},attrs:{data:e.modelList,border:"",size:"small"}},[r("el-table-column",{attrs:{label:"名称",align:"center",prop:"modelName"}}),r("el-table-column",{attrs:{label:"标识符",align:"center",prop:"identifier"}}),r("el-table-column",{attrs:{label:"物模型类别",align:"center",prop:"type"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("dict-tag",{attrs:{options:e.dict.type.iot_things_type,value:t.row.type}})]}}])}),r("el-table-column",{attrs:{label:"数据类型",align:"center",prop:"datatype"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("dict-tag",{attrs:{options:e.dict.type.iot_data_type,value:t.row.datatype}})]}}])}),r("el-table-column",{attrs:{label:"部件",align:"center",prop:"part"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.part)+" 系统定义的部件 ")]}}])})],1),r("el-divider",[e._v("高级功能")]),r("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"自定义页面",prop:"page"}},[r("el-input",{attrs:{placeholder:"请输入自定义页面"},model:{value:e.form.page,callback:function(t){e.$set(e.form,"page",t)},expression:"form.page"}})],1)],1)],1),r("el-col",{attrs:{span:8,offset:2}},[r("div",{staticClass:"phone"},[r("div",{staticClass:"phone-container"})]),r("div",{staticStyle:{"text-align":"center","margin-top":"15px",width:"370px"}},[e._v("界面展示")])])],1)],1)},a=[],o=r("01ca"),n={name:"device-log",dicts:["iot_things_type","iot_data_type","iot_yes_no"],props:{product:{type:Object,default:null}},data:function(){return{loading:!1,modelList:[],title:"",queryParams:{productId:0,type:4},form:{},productInfo:{}}},watch:{product:function(e,t){this.productInfo=e,this.productInfo&&0!=this.productInfo.productId&&(this.queryParams.productId=this.productInfo.productId,this.getList())}},created:function(){},methods:{getList:function(){var e=this;this.loading=!0,Object(o["f"])(this.queryParams).then((function(t){e.modelList=t.rows,e.total=t.total,e.loading=!1}))}}},l=n,s=(r("1464"),r("2877")),c=Object(s["a"])(l,i,a,!1,null,"acd2e2f8",null);t["default"]=c.exports},c59e:function(e,t,r){e.exports=r.p+"static/img/video.fb1e1b71.png"},dc57:function(e,t,r){},ddac:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{"padding-left":"20px"}},[r("el-form",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"68px"}},[r("el-form-item",{attrs:{label:"设备编号",prop:"serialNumber"}},[r("el-input",{attrs:{placeholder:"请输入设备编号",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.serialNumber,callback:function(t){e.$set(e.queryParams,"serialNumber",t)},expression:"queryParams.serialNumber"}})],1),r("el-form-item",{attrs:{label:"授权码",prop:"authorizeCode"}},[r("el-input",{attrs:{placeholder:"请输入授权码",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.authorizeCode,callback:function(t){e.$set(e.queryParams,"authorizeCode",t)},expression:"queryParams.authorizeCode"}})],1),r("el-form-item",{attrs:{label:"状态",prop:"status"}},[r("el-select",{attrs:{placeholder:"请选择状态",clearable:"",size:"small"},model:{value:e.queryParams.status,callback:function(t){e.$set(e.queryParams,"status",t)},expression:"queryParams.status"}},e._l(e.dict.type.iot_auth_status,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),r("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),r("el-row",{staticClass:"mb8",attrs:{gutter:10}},[r("el-col",{attrs:{span:1.5}},[r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:authorize:add"],expression:"['iot:authorize:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"mini"},on:{click:e.handleAdd}},[e._v("生成授权码")])],1),r("el-col",{attrs:{span:1.5}},[r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:authorize:remove"],expression:"['iot:authorize:remove']"}],attrs:{type:"danger",plain:"",icon:"el-icon-delete",size:"mini",disabled:e.multiple},on:{click:e.handleDelete}},[e._v("批量删除")])],1),r("el-col",{attrs:{span:1.5}},[r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:authorize:export"],expression:"['iot:authorize:export']"}],attrs:{type:"warning",plain:"",icon:"el-icon-download",size:"mini"},on:{click:e.handleExport}},[e._v("导出")])],1),r("el-col",{attrs:{span:1.5}},[r("el-link",{staticStyle:{"padding-top":"5px"},attrs:{type:"info",underline:!1}},[e._v("Tips：双击可以复制授权码。")])],1)],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.authorizeList,size:"small"},on:{"selection-change":e.handleSelectionChange,"cell-dblclick":e.celldblclick}},[r("el-table-column",{attrs:{type:"selection",selectable:e.selectable,width:"55",align:"center"}}),r("el-table-column",{attrs:{label:"授权码",width:"320",align:"center",prop:"authorizeCode"}}),r("el-table-column",{attrs:{label:"状态",align:"center",prop:"active",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("dict-tag",{attrs:{options:e.dict.type.iot_auth_status,value:t.row.status}})]}}])}),r("el-table-column",{attrs:{label:"设备编号",width:"150",align:"center",prop:"serialNumber"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(r){return e.getDeviceBySerialNumber(t.row.serialNumber)}}},[e._v(e._s(t.row.serialNumber))])]}}])}),r("el-table-column",{attrs:{label:"授权时间",align:"center",prop:"updateTime",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.parseTime(t.row.updateTime,"{y}-{m}-{d} {h}:{m}:{s}")))])]}}])}),r("el-table-column",{attrs:{label:"备注",align:"center",prop:"remark"}}),r("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[1!=t.row.status||t.row.deviceId?e._e():r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:authorize:edit"],expression:"['iot:authorize:edit']"}],attrs:{size:"mini",type:"text",icon:"el-icon-s-check"},on:{click:function(r){return e.handleUpdate(t.row,"auth")}}},[e._v("设备授权")]),r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:authorize:edit"],expression:"['iot:authorize:edit']"}],attrs:{size:"mini",type:"text",icon:"el-icon-notebook-1"},on:{click:function(r){return e.handleUpdate(t.row,"remark")}}},[e._v("备注")]),t.row.deviceId?e._e():r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:authorize:remove"],expression:"['iot:authorize:remove']"}],attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(r){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),r("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}),r("el-dialog",{attrs:{title:e.title,visible:e.open,width:e.editWidth,"append-to-body":""},on:{"update:visible":function(t){e.open=t}}},["auth"==e.editType?r("div",[r("div",{staticClass:"el-divider el-divider--horizontal",staticStyle:{"margin-top":"-25px"}}),r("el-form",{ref:"queryDeviceForm",attrs:{model:e.deviceParams,inline:!0,"label-width":"68px"}},[r("el-form-item",{attrs:{label:"设备名称",prop:"deviceName"}},[r("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"请输入设备名称",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.deviceParams.deviceName,callback:function(t){e.$set(e.deviceParams,"deviceName",t)},expression:"deviceParams.deviceName"}})],1),r("el-form-item",{staticStyle:{margin:"0 30px"},attrs:{label:"设备编号",prop:"serialNumber"}},[r("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"请输入设备编号",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.deviceParams.serialNumber,callback:function(t){e.$set(e.deviceParams,"serialNumber",t)},expression:"deviceParams.serialNumber"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleDeviceQuery}},[e._v("搜索")]),r("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetDeviceQuery}},[e._v("重置")])],1)],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.deviceLoading,expression:"deviceLoading"}],ref:"singleTable",attrs:{data:e.deviceList,size:"mini","highlight-current-row":""},on:{"row-click":e.rowClick}},[r("el-table-column",{attrs:{label:"选择",width:"50",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[r("input",{attrs:{type:"radio",name:"device"},domProps:{checked:e.row.isSelect}})]}}],null,!1,1388052008)}),r("el-table-column",{attrs:{label:"设备名称",align:"center",prop:"deviceName"}}),r("el-table-column",{attrs:{label:"设备ID",align:"center",prop:"deviceId"}}),r("el-table-column",{attrs:{label:"设备编号",align:"center",prop:"serialNumber"}}),r("el-table-column",{attrs:{label:"用户名称",align:"center",prop:"userName"}}),r("el-table-column",{attrs:{label:"设备状态",align:"center",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("dict-tag",{attrs:{options:e.dict.type.iot_device_status,value:t.row.status}})]}}],null,!1,2431977129)})],1),r("pagination",{directives:[{name:"show",rawName:"v-show",value:e.deviceTotal>0,expression:"deviceTotal>0"}],attrs:{total:e.deviceTotal,page:e.deviceParams.pageNum,limit:e.deviceParams.pageSize},on:{"update:page":function(t){return e.$set(e.deviceParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.deviceParams,"pageSize",t)},pagination:e.getDeviceList}})],1):e._e(),"remark"==e.editType?r("div",[r("el-input",{attrs:{type:"textarea",rows:"4",placeholder:"请输入内容"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1):e._e(),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")]),r("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)]),r("el-dialog",{attrs:{title:"设备详情",visible:e.openDevice,width:"600px","append-to-body":""},on:{"update:visible":function(t){e.openDevice=t}}},[null==e.device?r("div",{staticStyle:{"text-align":"center"}},[r("i",{staticClass:"el-icon-warning",staticStyle:{color:"#E6A23C"}}),e._v(" 提示：查找不到设备，可能已经被删除")]):e._e(),null!=e.device?r("el-descriptions",{attrs:{border:"",column:2,size:"medium"}},[r("el-descriptions-item",{attrs:{label:"设备ID"}},[e._v(e._s(e.device.deviceId))]),r("el-descriptions-item",{attrs:{label:"设备名称"}},[e._v(e._s(e.device.deviceName))]),r("el-descriptions-item",{attrs:{label:"设备编号"}},[e._v(e._s(e.device.serialNumber))]),r("el-descriptions-item",{attrs:{label:"设备状态"}},[1==e.device.status?r("el-tag",{attrs:{type:"warning"}},[e._v("未激活")]):2==e.device.status?r("el-tag",{attrs:{type:"danger"}},[e._v("禁用")]):3==e.device.status?r("el-tag",{attrs:{type:"success"}},[e._v("在线")]):4==e.device.status?r("el-tag",{attrs:{type:"info"}},[e._v("离线")]):e._e()],1),r("el-descriptions-item",{attrs:{label:"设备影子"}},[1==e.device.isShadow?r("el-tag",{attrs:{type:"success"}},[e._v("启用")]):r("el-tag",{attrs:{type:"info"}},[e._v("未启用")])],1),r("el-descriptions-item",{attrs:{label:"定位方式"}},[1==e.device.locationWay?r("el-tag",{attrs:{type:"success"}},[e._v("自动定位")]):2==e.device.locationWay?r("el-tag",{attrs:{type:"warning"}},[e._v("设备定位")]):3==e.device.locationWay?r("el-tag",{attrs:{type:"primary"}},[e._v("自定义位置")]):e._e()],1),r("el-descriptions-item",{attrs:{label:"产品名称"}},[e._v(e._s(e.device.productName))]),r("el-descriptions-item",{attrs:{label:"租户名称"}},[e._v(e._s(e.device.userName))]),r("el-descriptions-item",{attrs:{label:"固件版本"}},[e._v("Version "+e._s(e.device.firmwareVersion))]),r("el-descriptions-item",{attrs:{label:"所在地址"}},[e._v(e._s(e.device.networkAddress))]),r("el-descriptions-item",{attrs:{label:"设备经度"}},[e._v(e._s(e.device.longitude))]),r("el-descriptions-item",{attrs:{label:"设备纬度"}},[e._v(e._s(e.device.latitude))]),r("el-descriptions-item",{attrs:{label:"入网IP"}},[e._v(e._s(e.device.networkIp))]),r("el-descriptions-item",{attrs:{label:"设备信号"}},[e._v(e._s(e.device.rssi))]),r("el-descriptions-item",{attrs:{label:"创建时间"}},[e._v(e._s(e.device.createTime))]),r("el-descriptions-item",{attrs:{label:"激活时间"}},[e._v(e._s(e.device.activeTime))]),r("el-descriptions-item",{attrs:{label:"备注信息"}},[e._v(e._s(e.device.remark))])],1):e._e(),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.goToEditDevice(e.device.deviceId)}}},[e._v("查看设备")]),r("el-button",{on:{click:e.closeDevice}},[e._v("关 闭")])],1)],1)],1)},a=[],o=r("5530"),n=r("ade3"),l=(r("d81d"),r("584f")),s=r("b775");function c(e){return Object(s["a"])({url:"/iot/authorize/list",method:"get",params:e})}function u(e){return Object(s["a"])({url:"/iot/authorize/"+e,method:"get"})}function d(e){return Object(s["a"])({url:"/iot/authorize/addProductAuthorizeByNum",method:"post",data:e})}function m(e){return Object(s["a"])({url:"/iot/authorize",method:"put",data:e})}function p(e){return Object(s["a"])({url:"/iot/authorize/"+e,method:"delete"})}var f={name:"product-authorize",dicts:["iot_auth_status","iot_device_status"],props:{product:{type:Object,default:null}},watch:{product:function(e,t){this.productInfo=e,this.productInfo&&0!=this.productInfo.productId&&(this.queryParams.productId=this.productInfo.productId,this.deviceParams.productId=this.productInfo.productId,this.getList(),this.getDeviceList())}},data:function(){var e;return{device:{},openDevice:!1,deviceLoading:!0,deviceTotal:0,deviceList:[],deviceParams:(e={pageNum:1,pageSize:10,userId:null,deviceName:null,productId:0,productName:null},Object(n["a"])(e,"userId",null),Object(n["a"])(e,"userName",null),Object(n["a"])(e,"tenantId",null),Object(n["a"])(e,"tenantName",null),Object(n["a"])(e,"serialNumber",null),Object(n["a"])(e,"status",null),Object(n["a"])(e,"networkAddress",null),Object(n["a"])(e,"activeTime",null),e),editType:"",editWidth:"500px",loading:!0,ids:[],multiple:!0,showSearch:!0,total:0,authorizeList:[],title:"",open:!1,createNum:10,queryParams:{pageNum:1,pageSize:10,authorizeCode:null,productId:null,deviceId:null,serialNumber:null,userId:null,userName:null,status:null},form:{},productInfo:{}}},created:function(){},methods:{getDeviceBySerialNumber:function(e){var t=this;this.openDevice=!0,Object(l["f"])(e).then((function(e){t.device=e.data}))},goToEditDevice:function(e){this.openDevice=!1,this.$router.push({path:"/iot/device-edit",query:{deviceId:e}})},getDeviceList:function(){var e=this;this.deviceLoading=!0,this.deviceParams.params={},Object(l["l"])(this.deviceParams).then((function(t){e.deviceList=t.rows,e.deviceTotal=t.total,e.deviceLoading=!1}))},handleDeviceQuery:function(){this.deviceParams.pageNum=1,this.getDeviceList()},resetDeviceQuery:function(){this.resetForm("queryDeviceForm"),this.handleDeviceQuery()},rowClick:function(e){null!=e&&(this.setRadioSelected(e.deviceId),this.form.userId=e.userId,this.form.userName=e.userName,this.form.deviceId=e.deviceId,this.form.serialNumber=e.serialNumber)},setRadioSelected:function(e){for(var t=0;t<this.deviceList.length;t++){var r=this.deviceList[t];this.deviceList[t].deviceId==e?(r.isSelect=!0,this.$set(this.deviceList,t,r)):(r.isSelect=!1,this.$set(this.deviceList,t,r))}},getList:function(){var e=this;this.loading=!0,c(this.queryParams).then((function(t){e.authorizeList=t.rows,e.total=t.total,e.loading=!1}))},cancel:function(){this.open=!1,this.reset()},closeDevice:function(){this.openDevice=!1},reset:function(){this.form={authorizeId:null,authorizeCode:null,productId:"",userId:"",deviceId:null,serialNumber:null,userName:null,delFlag:null,createBy:null,createTime:null,updateBy:null,updateTime:null,remark:null},this.device={},this.resetForm("form")},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.authorizeId})),this.multiple=!e.length},handleAdd:function(){var e=this;this.$prompt("","输入授权码数量",{customClass:"createNum",confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/[0-9\-]/,inputErrorMessage:"数量内容不正确",inputType:"number",inputValue:this.createNum}).then((function(t){var r=t.value;if(e.createNum=r,null!=e.queryParams.productId){var i={productId:e.queryParams.productId,createNum:e.createNum};d(i).then((function(t){e.$modal.msgSuccess("新增授权码成功"),e.getList(),e.createNum=10}))}})).catch((function(){e.$message({type:"info",message:"取消新增"})}))},handleUpdate:function(e,t){var r=this;this.reset(),this.editType=t;var i=e.authorizeId||this.ids;u(i).then((function(e){r.form=e.data,r.open=!0,"auth"==r.editType?(r.title="选择设备",r.editWidth="800px"):(r.title="备注信息",r.editWidth="500px");for(var t=0;t<r.deviceList.length;t++){var i=r.deviceList[t];i.isSelect=!1,r.$set(r.deviceList,t,i)}}))},submitForm:function(){var e=this;"auth"==this.editType?null!=this.form.deviceId&&0!=this.form.deviceId?m(this.form).then((function(t){e.$modal.msgSuccess("设备授权成功"),e.open=!1,e.getList()})):this.$modal.msg("请选择要授权的设备"):null!=this.form.authorizeId&&m(this.form).then((function(t){e.$modal.msgSuccess("备注成功"),e.open=!1,e.getList()}))},handleDelete:function(e){var t=this,r=e.authorizeId||this.ids;this.$modal.confirm('是否确认删除产品授权码编号为"'+r+'"的数据项？').then((function(){return p(r)})).then((function(){t.getList(),t.$modal.msgSuccess("删除成功")})).catch((function(){}))},handleExport:function(){this.download("iot/authorize/export",Object(o["a"])({},this.queryParams),"authorize_".concat((new Date).getTime(),".xlsx"))},selectable:function(e){return null==e.deviceId},celldblclick:function(e,t,r,i){var a=this;this.$copyText(e[t.property]).then((function(e){a.onCopy()}),(function(e){this.onError()}))},onCopy:function(){this.$notify({title:"成功",message:"复制成功！",type:"success",offset:50,duration:2e3})},onError:function(){this.$notify({title:"失败",message:"复制失败！",type:"error",offset:50,duration:2e3})}}},h=f,v=(r("14a0"),r("2877")),b=Object(v["a"])(h,i,a,!1,null,null,null);t["default"]=b.exports},f155:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{padding:"6px"}},[r("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px"}},[r("el-row",{attrs:{gutter:100}},[r("el-col",{attrs:{xs:24,sm:24,md:12,lg:12,xl:8}},[r("el-form-item",{attrs:{label:"接入方式"}},[r("el-input",{attrs:{disabled:""},model:{value:e.accessWay,callback:function(t){e.accessWay=t},expression:"accessWay"}})],1),r("el-form-item",{attrs:{label:"服务器域",prop:"domain"}},[r("el-input",{attrs:{disabled:""},model:{value:e.form.domain,callback:function(t){e.$set(e.form,"domain",t)},expression:"form.domain"}})],1),r("el-form-item",{attrs:{label:"服务器ID",prop:"serverSipid"}},[r("el-input",{attrs:{disabled:""},model:{value:e.form.serverSipid,callback:function(t){e.$set(e.form,"serverSipid",t)},expression:"form.serverSipid"}})],1)],1),r("el-col",{attrs:{xs:24,sm:24,md:12,lg:12,xl:8}},[r("el-form-item",{attrs:{label:"服务器地址",prop:"ip"}},[r("el-input",{attrs:{disabled:""},model:{value:e.form.ip,callback:function(t){e.$set(e.form,"ip",t)},expression:"form.ip"}})],1),r("el-form-item",{attrs:{label:"服务器端口",prop:"port"}},[r("el-input",{attrs:{type:"number",disabled:""},model:{value:e.form.port,callback:function(t){e.$set(e.form,"port",t)},expression:"form.port"}})],1),r("el-form-item",{attrs:{label:"认证密码",prop:"password"}},[r("el-input",{attrs:{placeholder:"请输入认证密码"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)],1),r("el-col",{attrs:{xs:23,sm:23,md:23,lg:23,xl:15}},[r("el-form-item",{staticStyle:{"text-align":"center","margin-top":"20px"}},[r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:product:edit"],expression:"['iot:product:edit']"},{name:"show",rawName:"v-show",value:e.form.id&&2!=e.productInfo.status,expression:"form.id && productInfo.status!=2"}],attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("修 改")]),r("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:product:add"],expression:"['iot:product:add']"},{name:"show",rawName:"v-show",value:!e.form.id&&2!=e.productInfo.status,expression:"!form.id && productInfo.status!=2"}],attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("新 增")])],1)],1)],1)],1)],1)},a=[],o=r("3021"),n={name:"config-sip",props:{product:{type:Object,default:null}},watch:{product:function(e,t){this.productInfo=e,this.productInfo&&0!=this.productInfo.productId&&(this.form.id||this.getSipconfig(!0))}},data:function(){return{accessWay:"国标GB28181",loading:!0,ids:[],total:0,sipconfigList:[],title:"",open:!1,queryParams:{pageNum:1,pageSize:10,productId:null},form:{},rules:{domain:[{required:!0,message:"服务器域不能为空",trigger:"blur"}],serverSipid:[{required:!0,message:"服务器sipid不能为空",trigger:"blur"}],password:[{required:!0,message:"sip认证密码不能为空",trigger:"blur"}]}}},created:function(){this.productInfo=this.product,this.productInfo&&0!=this.productInfo.productId&&this.getSipconfig(!1)},methods:{getSipconfig:function(e){var t=this;Object(o["c"])(this.productInfo.productId,e).then((function(r){t.form=r.data,e&&t.submitForm()}))},submitForm:function(){var e=this;this.$refs["form"].validate((function(t){t&&(e.form.tenantId=e.product.tenantId,e.form.productId=e.product.productId,e.form.isdefault=1,null!=e.form.id?Object(o["d"])(e.form).then((function(t){e.$modal.msgSuccess("修改成功")})):Object(o["a"])(e.form).then((function(t){e.$modal.msgSuccess("新增成功"),e.form=t.data})))}))}}},l=n,s=(r("b690"),r("2877")),c=Object(s["a"])(l,i,a,!1,null,null,null);t["default"]=c.exports},ffab:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-card",{staticStyle:{margin:"6px","padding-bottom":"100px"}},[i("el-tabs",{staticStyle:{padding:"10px","min-height":"400px"},attrs:{"tab-position":"left"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{name:"basic"}},[i("span",{attrs:{slot:"label"},slot:"label"},[i("span",{staticStyle:{color:"red"}},[e._v("* ")]),e._v("基本信息")]),i("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[i("el-row",{attrs:{gutter:100}},[i("el-col",{attrs:{xs:24,sm:24,md:24,lg:12,xl:8}},[i("el-form-item",{attrs:{label:"产品名称",prop:"productName"}},[i("el-input",{attrs:{placeholder:"请输入产品名称",readonly:2==e.form.status},model:{value:e.form.productName,callback:function(t){e.$set(e.form,"productName",t)},expression:"form.productName"}})],1),i("el-form-item",{attrs:{label:"产品分类",prop:"categoryId"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择分类",disabled:2==e.form.status},on:{change:e.selectCategory},model:{value:e.form.categoryId,callback:function(t){e.$set(e.form,"categoryId",t)},expression:"form.categoryId"}},e._l(e.categoryShortList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),i("el-form-item",{attrs:{label:"设备类型",prop:"deviceType"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择设备类型",disabled:2==e.form.status},model:{value:e.form.deviceType,callback:function(t){e.$set(e.form,"deviceType",t)},expression:"form.deviceType"}},e._l(e.dict.type.iot_device_type,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:parseInt(e.value)}})})),1)],1),i("el-form-item",{attrs:{label:"联网方式",prop:"networkMethod"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择联网方式",disabled:2==e.form.status},model:{value:e.form.networkMethod,callback:function(t){e.$set(e.form,"networkMethod",t)},expression:"form.networkMethod"}},e._l(e.dict.type.iot_network_method,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:parseInt(e.value)}})})),1)],1),i("el-form-item",{attrs:{label:"备注信息",prop:"remark"}},[i("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",rows:"3",readonly:2==e.form.status},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),i("el-col",{attrs:{xs:24,sm:24,md:24,lg:12,xl:8}},[i("el-form-item",{attrs:{label:"启用授权",prop:"networkMethod"}},[i("el-switch",{attrs:{"active-value":1,"inactive-value":0,disabled:2==e.form.status||3==e.form.deviceType},on:{change:function(t){return e.changeIsAuthorize(e.form.isAuthorize)}},model:{value:e.form.isAuthorize,callback:function(t){e.$set(e.form,"isAuthorize",t)},expression:"form.isAuthorize"}})],1),i("el-form-item",{attrs:{label:"认证方式",prop:"vertificateMethod"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择认证方式",disabled:2==e.form.status||3==e.form.deviceType},model:{value:e.form.vertificateMethod,callback:function(t){e.$set(e.form,"vertificateMethod",t)},expression:"form.vertificateMethod"}},e._l(e.dict.type.iot_vertificate_method,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:parseInt(e.value)}})})),1)],1),i("el-form-item",{attrs:{label:"产品编号",prop:"productId"}},[i("el-input",{attrs:{placeholder:"自动生成",disabled:!e.form.mqttAccount||3==e.form.deviceType,readonly:""},model:{value:e.form.productId,callback:function(t){e.$set(e.form,"productId",t)},expression:"form.productId"}})],1),i("el-form-item",{attrs:{label:"Mqtt账号",prop:"mqttAccount"}},[i("el-input",{attrs:{placeholder:"不填自动生成",disabled:3==e.form.deviceType,readonly:"password"==e.accountInputType,type:e.accountInputType},model:{value:e.form.mqttAccount,callback:function(t){e.$set(e.form,"mqttAccount",t)},expression:"form.mqttAccount"}},[i("el-button",{staticStyle:{"font-size":"18px"},attrs:{slot:"append",icon:"el-icon-view"},on:{click:function(t){return e.changeInputType("account")}},slot:"append"})],1)],1),i("el-form-item",{attrs:{label:"Mqtt密码",prop:"mqttPassword"}},[i("el-input",{attrs:{placeholder:"不填则自动生成",disabled:3==e.form.deviceType,readonly:"password"==e.passwordInputType,type:e.passwordInputType},model:{value:e.form.mqttPassword,callback:function(t){e.$set(e.form,"mqttPassword",t)},expression:"form.mqttPassword"}},[i("el-button",{staticStyle:{"font-size":"18px"},attrs:{slot:"append",icon:"el-icon-view"},on:{click:function(t){return e.changeInputType("password")}},slot:"append"})],1)],1),i("el-form-item",{attrs:{label:"产品秘钥",prop:"mqttSecret"}},[i("el-input",{attrs:{placeholder:"自动生成",disabled:!e.form.mqttAccount||3==e.form.deviceType,readonly:"",type:e.keyInputType},model:{value:e.form.mqttSecret,callback:function(t){e.$set(e.form,"mqttSecret",t)},expression:"form.mqttSecret"}},[i("el-button",{staticStyle:{"font-size":"18px"},attrs:{slot:"append",icon:"el-icon-view"},on:{click:function(t){return e.changeInputType("key")}},slot:"append"})],1)],1)],1),i("el-col",{attrs:{xs:24,sm:24,md:24,lg:12,xl:8}},[i("el-form-item",{attrs:{label:"产品图片"}},[2==e.form.status&&null==e.form.imgUrl?i("div",[2==e.form.deviceType?i("el-image",{staticStyle:{height:"145px","border-radius":"10px"},attrs:{"preview-src-list":[r("4efc")],src:r("4efc"),fit:"cover"}}):3==e.form.deviceType?i("el-image",{staticStyle:{height:"145px","border-radius":"10px"},attrs:{"preview-src-list":[r("c59e")],src:r("c59e"),fit:"cover"}}):i("el-image",{staticStyle:{height:"145px","border-radius":"10px"},attrs:{"preview-src-list":[r("52bb")],src:r("52bb"),fit:"cover"}})],1):i("div",[i("imageUpload",{ref:"image-upload",attrs:{disabled:!0,value:e.form.imgUrl,limit:2==e.form.status?0:1,fileSize:1},on:{input:function(t){return e.getImagePath(t)}}})],1),null==e.form.productId||0==e.form.productId?i("div",{staticClass:"el-upload__tip",staticStyle:{color:"#f56c6c"}},[e._v("提示：上传后需要提交保存")]):e._e()])],1)],1),i("el-col",{attrs:{span:20}},[i("el-form-item",{staticStyle:{"text-align":"center",margin:"40px 0px"}},[i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:product:edit"],expression:"['iot:product:edit']"},{name:"show",rawName:"v-show",value:0!=e.form.productId&&2!=e.form.status,expression:"form.productId!=0 && form.status!=2"}],attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("修 改")]),i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:product:add"],expression:"['iot:product:add']"},{name:"show",rawName:"v-show",value:0==e.form.productId&&2!=e.form.status,expression:"form.productId==0 && form.status!=2"}],attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("新 增")])],1)],1)],1)],1),3!==e.form.deviceType?i("el-tab-pane",{attrs:{label:"",name:"things",disabled:0==e.form.productId}},[i("span",{attrs:{slot:"label"},slot:"label"},[i("span",{staticStyle:{color:"red"}},[e._v("* ")]),e._v("产品模型")]),i("product-things-model",{ref:"productThingsModel",attrs:{product:e.form}})],1):e._e(),3!==e.form.deviceType?i("el-tab-pane",{attrs:{label:"",name:"productFirmware",disabled:0==e.form.productId}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("固件管理")]),i("product-firmware",{ref:"productFirmware",attrs:{product:e.form}})],1):e._e(),3!==e.form.deviceType?i("el-tab-pane",{attrs:{label:"",name:"productAuthorize",disabled:0==e.form.productId}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("设备授权")]),i("product-authorize",{ref:"productAuthorize",attrs:{product:e.form}})],1):e._e(),3!==e.form.deviceType?i("el-tab-pane",{attrs:{label:"",name:"alert",disabled:0==e.form.productId}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v(" 告警配置")]),i("product-alert",{ref:"productAlert",attrs:{product:e.form}})],1):e._e(),3===e.form.deviceType?i("el-tab-pane",{attrs:{label:"",name:"sipConfig",disabled:0==e.form.productId}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("SIP配置")]),i("config-sip",{ref:"configSip",attrs:{product:e.form}})],1):e._e(),i("div",{staticStyle:{"margin-top":"200px"}}),i("el-tab-pane",[i("span",{attrs:{slot:"label"},slot:"label"},[i("div",{staticStyle:{"margin-top":"200px"}})])]),1==e.form.status?i("el-tab-pane",{attrs:{name:"product04"}},[i("span",{attrs:{slot:"label"},slot:"label"},[i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:product:add"],expression:"['iot:product:add']"}],attrs:{type:"success",size:"mini"},on:{click:function(t){return e.changeProductStatus(2)}}},[e._v("发布产品")])],1)]):e._e(),2==e.form.status?i("el-tab-pane",{attrs:{name:"product05"}},[i("span",{attrs:{slot:"label"},slot:"label"},[i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:product:edit"],expression:"['iot:product:edit']"}],attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.changeProductStatus(1)}}},[e._v("取消发布")])],1)]):e._e(),i("el-tab-pane",{attrs:{name:"product06"}},[i("span",{attrs:{slot:"label"},slot:"label"},[i("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(t){return e.goBack()}}},[e._v("返回列表")])],1)])],1)],1)},a=[],o=r("c7eb"),n=r("1da1"),l=(r("a9e3"),r("d3b7"),r("b0c0"),r("416d")),s=r("9355"),c=r("bbfb"),u=r("1850"),d=r("ddac"),m=r("0835"),p=r("f155"),f=r("1e36"),h=r("9b9c"),v={name:"ProductEdit",dicts:["iot_device_type","iot_network_method","iot_vertificate_method"],components:{productThingsModel:l["default"],productApp:c["default"],productAlert:u["default"],productAuthorize:d["default"],productFirmware:s["default"],imageUpload:m["a"],configSip:p["default"]},data:function(){return{keyInputType:"password",accountInputType:"password",passwordInputType:"password",activeName:"basic",categoryShortList:[],form:{networkMethod:1,deviceType:1,vertificateMethod:3},rules:{productName:[{required:!0,message:"产品名称不能为空",trigger:"blur"}],categoryId:[{required:!0,message:"产品分类ID不能为空",trigger:"blur"}]},queryParams:{tenantName:null}}},created:function(){var e=this.$route.query&&this.$route.query.productId;this.form.productId=e,0!=this.form.productId&&null!=this.form.productId&&this.getProduct();var t=this.$route.query&&this.$route.query.tabPanelName;null!=t&&""!=t&&(this.activeName=t),this.getShortCategory(),this.form.productId&&0!=this.form.productId||(this.accountInputType="text",this.passwordInputType="text")},activated:function(){var e=this.$route.query.t;if(null!=e&&e!=this.uniqueId){this.uniqueId=e;var t=this.$route.query.productId;null!=t&&0!=t&&(this.form.productId=Number(t),this.getProduct(),this.getShortCategory());var r=this.$route.query&&this.$route.query.tabPanelName;null!=r&&""!=r&&(this.activeName=r)}},methods:{getShortCategory:function(){var e=this;Object(f["e"])().then((function(t){e.categoryShortList=t.data}))},goBack:function(){var e={path:"/iot/product",query:{t:Date.now(),pageNum:this.$route.query.pageNum}};this.$tab.closeOpenPage(e),this.reset()},getProduct:function(){var e=this;Object(h["e"])(this.form.productId).then((function(t){e.form=t.data}))},reset:function(){this.form={productId:0,productName:null,categoryId:null,categoryName:null,status:0,tslJson:null,isAuthorize:0,deviceType:1,networkMethod:1,vertificateMethod:3,mqttAccount:null,mqttPassword:null,mqttSecret:null,remark:null},this.resetForm("form")},submitForm:function(){var e=this;this.$refs["form"].validate((function(t){t&&(null!=e.form.productId&&0!=e.form.productId?Object(h["h"])(e.form).then((function(t){e.$modal.alertSuccess("修改成功")})):Object(h["a"])(e.form).then((function(t){e.$modal.alertSuccess("添加成功,可以开始定义物模型或配置"),e.form=t.data})))}))},getDeviceCountByProductId:function(e){return new Promise((function(t,r){Object(h["d"])(e).then((function(e){t(e)})).catch((function(e){r(e)}))}))},changeProductStatus:function(e){var t=this;return Object(n["a"])(Object(o["a"])().mark((function r(){var i,a;return Object(o["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(i="确定取消发布？",2!=e){r.next=5;break}i="产品发布后，可以创建对应的设备",r.next=10;break;case 5:if(1!=e){r.next=10;break}return r.next=8,t.getDeviceCountByProductId(t.form.productId);case 8:a=r.sent,a.data>0&&(i="重要提示：产品下已有 "+a.data+" 个设备，取消发布可以修改产品信息和模型，重新发布后对应设备状态将会被重置！");case 10:t.$confirm(i,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var r={};r.productId=t.form.productId,r.status=e,r.deviceType=t.form.deviceType,Object(h["b"])(r).then((function(e){t.$modal.alertSuccess(e.msg),t.activeName="basic",t.getProduct()})).catch((function(){2==e?t.activeName="basic":t.goBack()}))})).catch((function(){t.activeName="basic"}));case 11:case"end":return r.stop()}}),r)})))()},selectCategory:function(e){for(var t=0;t<this.categoryShortList.length;t++)if(this.categoryShortList[t].id==e)return void(this.form.categoryName=this.categoryShortList[t].name)},getImagePath:function(e){this.form.imgUrl=e},changeInputType:function(e){"key"==e?this.keyInputType="password"==this.keyInputType?"text":"password":"account"==e?this.accountInputType="password"==this.accountInputType?"text":"password":"password"==e&&(this.passwordInputType="password"==this.passwordInputType?"text":"password")},changeIsAuthorize:function(){var e=this,t="1"==this.form.isAuthorize?"启用":"停用";this.$modal.confirm("确认要"+t+"授权码吗？").then((function(){null!=e.form.productId&&0!=e.form.productId&&Object(h["h"])(e.form).then((function(r){e.$modal.alertSuccess("授权码已"+t)}))})).catch((function(){e.form.isAuthorize=0}))}}},b=v,g=r("2877"),y=Object(g["a"])(b,i,a,!1,null,null,null);t["default"]=y.exports}}]);